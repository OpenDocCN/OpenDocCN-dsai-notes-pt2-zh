# (超爽中英!) 2024公认最全的【吴恩达大模型LLM】系列教程！附代码_LangChain_微调ChatGPT提示词_RAG模型应用_agent_生成式AI - P31：7——代理 - 吴恩达大模型 - BV1gLeueWE5N

![](img/b3647b51d77e6b78045ac95d56632965_0.png)

有时人们认为大语言模型是知识库，因为它学习记忆大量信息，可能来自互联网，当你提问时，它能回答问题，但更实用的看法是将其视为推理引擎，你可以给它文本块或其他信息源，然后大型语言模型（LM）。

可能使用从互联网学到的背景知识，来回答问题，用新信息帮你回答问题，或决定下一步做什么，这就是lang chain的代理框架，代理可能是我最喜欢的部分，我认为它们也是最强大的部分，但它们也是最新的部分。

我们正在看到很多新东西出现，这对领域内所有人都是全新的，这应该是一堂非常令人兴奋的课程，当我们深入探讨代理是什么，如何使用代理，如何装备不同工具，如内建语言链的搜索引擎，以及如何创建自己的工具。

这样可以让代理与任何数据存储交互，任何API，任何你想要的功能，这是令人兴奋的前沿技术，但已有重要的应用案例，那么让我们深入探讨，首先，我们将设置环境变量，并导入稍后使用的许多东西。



![](img/b3647b51d77e6b78045ac95d56632965_2.png)

我们将初始化语言模型。

![](img/b3647b51d77e6b78045ac95d56632965_4.png)

我们将使用Chat Open AI，重要的是，我们将温度设置为0。

![](img/b3647b51d77e6b78045ac95d56632965_6.png)

这很重要，因为我们将使用语言模型作为代理的推理引擎，它与其他数据和计算源连接。

![](img/b3647b51d77e6b78045ac95d56632965_8.png)

因此我们希望这个推理引擎尽可能好和精确，因此我们将它设置为0，消除任何可能出现的不确定性，接下来加载一些工具，将加载两个工具：llm数学工具和维基百科工具。



![](img/b3647b51d77e6b78045ac95d56632965_10.png)

llm数学工具实际上是一个链本身，结合语言模型和计算器解决数学问题。

![](img/b3647b51d77e6b78045ac95d56632965_12.png)

维基百科工具是一个API，连接到维基百科，允许您对维基百科运行搜索查询并获取结果。

![](img/b3647b51d77e6b78045ac95d56632965_14.png)

接下来初始化一个代理，将使用工具初始化代理。

![](img/b3647b51d77e6b78045ac95d56632965_16.png)

语言模型，然后输入代理类型，我们将使用chat零射反应描述。

![](img/b3647b51d77e6b78045ac95d56632965_18.png)

注意这里首先是chat，这是一个优化与聊天模型合作的代理。

![](img/b3647b51d77e6b78045ac95d56632965_20.png)

其次是react，这是一种设计用来从语言模型中获得最佳推理性能的提示技术。

![](img/b3647b51d77e6b78045ac95d56632965_22.png)

我们还将传入handle_parsing_errors等于true。

![](img/b3647b51d77e6b78045ac95d56632965_24.png)

当语言模型可能输出无法解析的内容时，这很有用，嗯，无法解析成动作和动作输入。

![](img/b3647b51d77e6b78045ac95d56632965_26.png)

这是期望的输出，当这种情况发生时。

![](img/b3647b51d77e6b78045ac95d56632965_28.png)

实际上我们会将格式错误的文本传回语言模型，并要求它纠正自己。

![](img/b3647b51d77e6b78045ac95d56632965_30.png)

最后我们将传入verbose等于true，这将在jupyter笔记本中打印出很多步骤，使我们非常清楚，正在发生什么，我们稍后将在笔记本的全球级别设置debug等于true。



![](img/b3647b51d77e6b78045ac95d56632965_32.png)

这样我们可以更详细地了解到底发生了什么，首先我们将向代理询问一个数学问题，三百的百分之二十五是多少。

![](img/b3647b51d77e6b78045ac95d56632965_34.png)

这是一个相当简单的问题，但了解确切发生了什么将是有益的，因此，我们可以看到，当它进入代理执行链时。

![](img/b3647b51d77e6b78045ac95d56632965_36.png)

它首先考虑需要做什么。

![](img/b3647b51d77e6b78045ac95d56632965_38.png)

所以它有一个想法。

![](img/b3647b51d77e6b78045ac95d56632965_40.png)

然后它有一个动作，这个动作实际上是一个块，对应两个东西，一个动作和一个动作输入，动作对应要使用的工具。



![](img/b3647b51d77e6b78045ac95d56632965_42.png)

所以这里是计算器，动作输入是该工具的输入。

![](img/b3647b51d77e6b78045ac95d56632965_44.png)

这里它是三百乘以点二五的字符串，接下来我们可以看到，带有答案的观察以不同的颜色出现。

![](img/b3647b51d77e6b78045ac95d56632965_46.png)

这个观察答案等于七十五点零实际上是来自计算器工具本身。

![](img/b3647b51d77e6b78045ac95d56632965_48.png)

接下来我们回到语言模型，当文本变成绿色时。

![](img/b3647b51d77e6b78045ac95d56632965_50.png)

我们有问题的答案，最终答案，七十五点零，这是我们得到的输出，现在是一个暂停并尝试自己不同数学问题的好时机，接下来我们将通过wikipedia api的例子，这里我们将问你关于汤姆·米切尔的问题。



![](img/b3647b51d77e6b78045ac95d56632965_52.png)

我们可以查看中间步骤来了解它做了什么。

![](img/b3647b51d77e6b78045ac95d56632965_54.png)

我们可以再次看到它思考。

![](img/b3647b51d77e6b78045ac95d56632965_56.png)

并且它正确地意识到应该使用wikipedia，它说动作等于wikipedia，动作输入等于汤姆·米切尔。



![](img/b3647b51d77e6b78045ac95d56632965_58.png)

这次观察以黄色返回，我们使用不同的颜色来表示不同的工具，注意这里首先是chat，这是一个优化与聊天模型合作的代理，维基百科汤姆·米切尔页面的总结结果，从维基百科返回的观察结果是两个结果，两个页面。

因为有两位不同的汤姆·米切尔，我们可以看到第一个页面涵盖了计算机科学家，第二个页面，看起来是一位澳大利亚足球运动员，我们可以看到回答这个问题所需的信息，即他写的那本书的名字。

机器学习出现在第一个汤姆·米切尔的摘要中，我们可以看到接下来代理试图查找更多关于这本书的信息，所以它查找了维基百科上的机器学习书籍，这并不严格必要，这是一个有趣的例子，展示了代理并不完全可靠。

但我们可以看到在这次查找之后，代理意识到它拥有所有需要回答的信息，并回答了正确的答案，机器学习，接下来我们要看的是一个很酷的例子，如果你见过像Copilot或带有代码解释器插件的Chat GPT。



![](img/b3647b51d77e6b78045ac95d56632965_60.png)

他们正在使用语言模型编写代码，然后执行该代码。

![](img/b3647b51d77e6b78045ac95d56632965_62.png)

我们在这里可以做完全相同的事情，所以我们要创建一个Python代理，并且我们将使用之前相同的LLM，我们将给它一个工具，Python REPL工具，REPL基本上是一种与代码交互的方式。

你可以把它想象成一个Jupyter笔记本，所以代理可以使用这个REPL执行代码，它将运行。

![](img/b3647b51d77e6b78045ac95d56632965_64.png)

然后我们会得到一些结果，这些结果将被返回给代理，所以它可以决定接下来做什么。

![](img/b3647b51d77e6b78045ac95d56632965_66.png)

我们要让这个代理解决的问题是。

![](img/b3647b51d77e6b78045ac95d56632965_68.png)

我们将给它一个名字列表，然后要求它按姓氏排序，所以你可以看到这里。

![](img/b3647b51d77e6b78045ac95d56632965_70.png)

我们有一个名字列表，哈里森，蔡斯，语言链LLM，杰夫，融合变压器，生成AI。

![](img/b3647b51d77e6b78045ac95d56632965_72.png)

我们将要求代理首先按姓氏排序这些名字，然后按名字排序。

![](img/b3647b51d77e6b78045ac95d56632965_74.png)

然后打印输出，重要的是我们要求它打印输出，这样它实际上可以看到结果是什么。

![](img/b3647b51d77e6b78045ac95d56632965_76.png)

以便它可以决定接下来做什么。

![](img/b3647b51d77e6b78045ac95d56632965_78.png)

这些打印的语句稍后将回传给语言模型，以便它能推理刚运行的代码的输出。

![](img/b3647b51d77e6b78045ac95d56632965_80.png)

让我们试试，进入代理执行链时。

![](img/b3647b51d77e6b78045ac95d56632965_82.png)

它首先意识到可以使用sorted函数列出客户。

![](img/b3647b51d77e6b78045ac95d56632965_84.png)

![](img/b3647b51d77e6b78045ac95d56632965_85.png)

内部使用了不同类型的代理，这就是为什么动作和动作输入的格式略有不同，这里，它采取的行动是使用Python REPL，你可以看到动作输入实际上是代码，首先写出客户，等于这个列表，然后对客户排序。

然后遍历这个列表并打印。

![](img/b3647b51d77e6b78045ac95d56632965_87.png)

你可以看到，代理考虑要做什么并意识到需要编写一些代码，动作和动作输入的格式与之前略有不同。

![](img/b3647b51d77e6b78045ac95d56632965_89.png)

它使用的是内部不同的代理类型来执行动作，它将使用Python REPL，对于动作输入，它将有一堆代码，所以如果我们看看这段代码在做什么，它首先创建一个变量来列出这些客户名称。

然后对它排序并创建一个新的变量。

![](img/b3647b51d77e6b78045ac95d56632965_91.png)

然后遍历这个新变量并打印每行。

![](img/b3647b51d77e6b78045ac95d56632965_93.png)

就像我们要求它做的，我们可以看到我们得到了观察结果，这是一个名字列表。

![](img/b3647b51d77e6b78045ac95d56632965_95.png)

然后代理意识到它完成了并返回这些名字，从打印出的内容中，我们可以看到正在发生的高层情况。

![](img/b3647b51d77e6b78045ac95d56632965_97.png)

但让我们深入一点并使用lane chain debug运行，设置为true，因为这会打印出所有不同链的所有级别的所有内容，让我们看看它们到底在做什么，所以首先我们从代理执行器开始，这是顶级代理运行器。

我们可以看到我们这里有，我们的输入，按姓氏和名字排序客户，然后打印输出，从这里我们调用一个llm链。

![](img/b3647b51d77e6b78045ac95d56632965_99.png)

这是代理使用的lm链，所以lm链记住了一个提示和lms的组合，此时它只在代理草稿中有输入，我们稍后会回到这一点，以及一些停止序列来告诉语言模型何时停止生成，在下一级，我们看到对语言模型的确切调用。

所以我们可以看到完全格式的提示，它包括关于它可访问的工具的说明以及如何格式化其输出的说明，从那里可以看到语言模型的确切输出，可以看到文本键，包含思想和行动，并将所有内容放入一个字符串。

然后它通过那里结束llm链，接下来它调用的是一个工具，可以看到工具的确切输入。

![](img/b3647b51d77e6b78045ac95d56632965_101.png)

也可以看到工具的名称，Python repl，然后可以看到输入，即这段代码，然后可以看到该工具的输出，即打印出的字符串，同样，这是因为特别要求Python repl打印出正在发生的事情。

然后可以看到下一个输入到llm链，这里如果看变量，llm链是代理，所以这里，如果看变量，输入未改变，这是我们要求的高层目标，但现在agent scratch pad有一些新值。

可以看到这是之前生成的组合加上工具输出，并将此返回，以便语言模型理解之前发生了什么并使用它来推理接下来要做什么，接下来的几个打印语句涵盖了，当语言模型意识到它基本上完成了工作时会发生什么。

可以看到完全格式的语言模型提示，响应，它意识到它已经完成。

![](img/b3647b51d77e6b78045ac95d56632965_103.png)

并说最终答案，这里是代理用来识别它已经完成工作的序列，然后可以看到它退出llm链然后退出代理执行器，这应该能让你很好地了解内部发生了什么，在这些代理中。



![](img/b3647b51d77e6b78045ac95d56632965_105.png)

这应该能让你很好地了解内部发生了什么，并且希望是有指导意义的，当你暂停并设置自己的编码代理目标时，试图完成。



![](img/b3647b51d77e6b78045ac95d56632965_107.png)

这种调试模式也可以用来突出显示哪里出了问题，如上面的维基百科示例所示。

![](img/b3647b51d77e6b78045ac95d56632965_109.png)

有时代理行为有点古怪，所以拥有所有这些信息对于理解正在发生的事情真的很有帮助。

![](img/b3647b51d77e6b78045ac95d56632965_111.png)

到目前为止，我们使用了LinkedIn上已经找到的工具。

![](img/b3647b51d77e6b78045ac95d56632965_113.png)

但代理的一大力量是你可以将其连接到你自己的信息源，你自己的API，你自己的数据。

![](img/b3647b51d77e6b78045ac95d56632965_115.png)

所以这里我们将介绍如何创建自定义工具，以便你可以将其连接到你想要的一切。

![](img/b3647b51d77e6b78045ac95d56632965_117.png)

让我们先做一个工具，它会告诉我们当前日期。

![](img/b3647b51d77e6b78045ac95d56632965_119.png)

我们将导入这个工具装饰器，这可以应用于任何函数，并将其转换为LinkedIn可以使用的工具。

![](img/b3647b51d77e6b78045ac95d56632965_121.png)

我们要写一个函数，叫time，它在任何文本字符串中震动，我们实际上不会使用它，它将通过调用date time返回今天的日期。



![](img/b3647b51d77e6b78045ac95d56632965_123.png)

除了函数名外，我们还将编写一个非常详细的文档字符串。

![](img/b3647b51d77e6b78045ac95d56632965_125.png)

因为这就是代理将用来知道何时应该调用此工具的原因。

![](img/b3647b51d77e6b78045ac95d56632965_127.png)

以及如何调用此工具，例如，这里我们说输入应该始终为空字符串，因为我们不使用它，如果我们对输入应该有更严格的要求。



![](img/b3647b51d77e6b78045ac95d56632965_129.png)

例如，如果我们有一个函数应该始终接受搜索查询或SQL语句。

![](img/b3647b51d77e6b78045ac95d56632965_131.png)

您将希望确保在这里提及这一点，我们现在将创建另一个代理，这次我们将时间工具添加到现有工具列表中。

![](img/b3647b51d77e6b78045ac95d56632965_133.png)

最后让我们调用代理并询问它今天的日期。

![](img/b3647b51d77e6b78045ac95d56632965_135.png)

它认识到需要使用时间工具，在这里指定，它有动作输入为空字符串，这很好，这是我们告诉它要做的，然后它返回一个观察结果，然后最终语言模型取该观察结果并响应用户，今天日期是2023年，05月，21日。

在这里暂停视频并尝试输入不同内容，代理课程结束，这是长链中较新、更令人兴奋和更实验性的一部分，希望你喜欢使用它，希望它展示了如何使用语言模型作为推理引擎。



![](img/b3647b51d77e6b78045ac95d56632965_137.png)