#  【LangChain大模型应用开发】DeepLearning.AI - P15：7——完整功能的聊天机器人 - 吴恩达大模型 - BV1iZ421M79T

![](img/50b76bf8c477b208a834e72d4141c649_0.png)

我们离拥有一个功能正常的聊天机器人如此之近，我们从装载文件开始，然后我们把他们分开，然后我们创建了一个向量存储，我们谈到了不同类型的检索，我们已经证明了我们可以回答问题，但是我们不能处理后续的问题。

我们不能和它进行真正的对话，好消息是，我们会解决的，在这节课中，让我们弄清楚，我们现在要做一个问题来结束，回答聊天，它要做的是看起来和以前非常相似，但我们要加入聊天历史的概念。

这是您以前与连锁店交换的任何对话或信息，这将允许它做什么，它会允许它将聊天历史纳入上下文吗，当它试图回答问题时，所以如果你问一个后续问题，它会知道你在说什么。



![](img/50b76bf8c477b208a834e72d4141c649_2.png)

要注意的一件重要的事，到目前为止，我们谈到的所有很酷的检索类型，像自查询或压缩，或者类似的东西，你绝对可以在这里使用它们，我们谈到的所有组件都是非常模块化的，可以组合在一起，很好。

我们只是加入了聊天历史的概念。

![](img/50b76bf8c477b208a834e72d4141c649_4.png)

让我们先看看它是什么样子，一如既往，我们要加载环境变量。

![](img/50b76bf8c477b208a834e72d4141c649_6.png)

如果你设置了平台，打开它也可能很好，从一开始，会有很多很酷的东西想看，引擎盖下是怎么回事。

![](img/50b76bf8c477b208a834e72d4141c649_8.png)

我们将加载我们的向量存储，其中包含所有的嵌入，所有的课堂材料。

![](img/50b76bf8c477b208a834e72d4141c649_10.png)

我们可以在向量存储上进行基本相似性搜索。

![](img/50b76bf8c477b208a834e72d4141c649_12.png)

我们可以初始化我们将用作聊天机器人的语言模型。

![](img/50b76bf8c477b208a834e72d4141c649_14.png)

然后，这都是以前的。

![](img/50b76bf8c477b208a834e72d4141c649_16.png)

这就是为什么我这么快就浏览了一遍，我们可以初始化一个提示模板，创建检索QA链，然后递进一个问题，得到一个结果。



![](img/50b76bf8c477b208a834e72d4141c649_18.png)

但现在让我们做更多，让我们给它添加一些记忆，所以我们将使用会话缓冲内存，它的作用是，它只是简单地保留一个列表，历史上聊天消息的缓冲区，它会把这些和问题一起传递给聊天机器人，每次我们要指定内存键。

聊天历史记录，这只是将它与提示符中的一个输入变量对齐，然后我们将指定返回消息等于true，这将以消息列表的形式返回聊天历史记录，与单个字符串相反，这是最简单的内存类型，可以更深入地研究内存。

回到我和安德鲁教的第一堂课，我们详细报道了这件事。

![](img/50b76bf8c477b208a834e72d4141c649_20.png)

然后呢，现在让我们创建一种新型的链，会话检索链，我们传入语言模型，我们通过寻回器，我们通过记忆，会话检索链在检索的基础上增加了一个新的位，Qa链，不仅仅是记忆，尤其是，它增加的是，它增加了一个步骤。

带着历史和新的问题，把它浓缩成一个独立的问题，传递到向量存储，查阅有关文件，我们将在UI中查看这一点，在我们运行它，看看它有什么影响。



![](img/50b76bf8c477b208a834e72d4141c649_22.png)

但现在让我们试试，我们可以问一个问题，这是没有任何历史的。

![](img/50b76bf8c477b208a834e72d4141c649_24.png)

看看我们得到的结果，然后我们可以问一个后续问题，这和以前一样，所以我们要问的是，课堂主题，我们得到一些答案，教师假设学生对概率和统计学有基本的了解，然后我们问，为什么需要这些先决条件，我们得到一个结果。

让我们看看。

![](img/50b76bf8c477b208a834e72d4141c649_26.png)

我们得到一个答案，现在我们可以看到答案是指基本的概率和统计作为先决条件，在此基础上，不要把它与计算机科学混淆。



![](img/50b76bf8c477b208a834e72d4141c649_28.png)

就像以前一样。

![](img/50b76bf8c477b208a834e72d4141c649_30.png)

让我们来看看UI的引擎盖下发生了什么，所以在这里我们已经可以看到有更多的复杂性。

![](img/50b76bf8c477b208a834e72d4141c649_32.png)

我们可以看到，现在链的输入不仅有问题。

![](img/50b76bf8c477b208a834e72d4141c649_34.png)

也是聊天历史，聊天历史是从记忆中走来的，这将在链被调用并登录到日志系统之前应用。

![](img/50b76bf8c477b208a834e72d4141c649_36.png)

如果我们看一下痕迹，我们可以看到有两件独立的事情在发生，首先是对一个项目的调用，然后有人打电话给填充文件链，让我们来看看第一个电话。



![](img/50b76bf8c477b208a834e72d4141c649_38.png)

我们可以在这里看到一个带有一些说明的提示符，鉴于下面的对话，后续问题，将后续问题改写为独立问题。

![](img/50b76bf8c477b208a834e72d4141c649_40.png)

这里我们有以前的历史，所以我们有一个问题，我们首先问的是课堂主题的概率，然后我们就有了帮助答案，然后在这里我们有一个独立的问题，要求基本概率和统计作为类的先决条件的原因是什么。



![](img/50b76bf8c477b208a834e72d4141c649_42.png)

发生的情况是，独立的答案随后被传递给检索器，我们取回四或三份文件，或者不管有多少，我们指定，然后，我们将这些文档传递到填充文档链，并试图回答最初的问题。



![](img/50b76bf8c477b208a834e72d4141c649_44.png)

所以如果我们调查一下，我们可以看到我们有了系统答案，使用以下上下文来回答用户的问题。

![](img/50b76bf8c477b208a834e72d4141c649_46.png)

我们有一堆背景。

![](img/50b76bf8c477b208a834e72d4141c649_48.png)

然后我们在下面有问题的摊位，然后我们得到一个答案，以下是与手头问题相关的答案。

![](img/50b76bf8c477b208a834e72d4141c649_50.png)

它是关于概率和统计作为先决条件，现在是暂停并尝试这个链的不同选项的好时机，您可以传递不同的提示模板，不仅仅是为了回答问题，但也因为把它变成了一个独立的问题。



![](img/50b76bf8c477b208a834e72d4141c649_52.png)

您可以尝试不同类型的内存，有很多不同的选择可以离开这里。

![](img/50b76bf8c477b208a834e72d4141c649_54.png)

在这之后，我们要把它放在一个漂亮的UI中，会有很多代码来创建这个用户界面，但这是最重要的一点。

![](img/50b76bf8c477b208a834e72d4141c649_56.png)

尤其是，这是一个完整的演练，基本上整个班，所以我们要加载一个数据库和检索链，我们要传递一份文件，我们要用PDF加载器加载它，他们会把它加载到文档中，我们要把那些文件分开，我们将创建一些嵌入。

并将其放在向量存储中，然后我们要把矢量存储变成寻回器。

![](img/50b76bf8c477b208a834e72d4141c649_58.png)

我们将在这里使用相似性和一些K的搜索线。

![](img/50b76bf8c477b208a834e72d4141c649_60.png)

我们将其设置为一个参数，我们可以传入，然后我们将创建会话检索链，这里要注意的一件重要的事情是，我们不是在记忆中传递，我们将从外部管理内存，为了方便下面的GUI，这意味着聊天历史将不得不在链外进行管理。



![](img/50b76bf8c477b208a834e72d4141c649_62.png)

然后我们在这里有更多的代码--我们不会在上面花太多时间，但指出这里我们在聊天历史中传递到链中。

![](img/50b76bf8c477b208a834e72d4141c649_64.png)

这也是因为我们没有附加的记忆。

![](img/50b76bf8c477b208a834e72d4141c649_66.png)

然后我们在这里扩展聊天历史记录，有了结果，然后我们就可以把它放在一起了，运行这个来获得一个漂亮的用户界面，通过它我们可以与我们的聊天机器人交互，然后呢，我问你一个问题，助教是谁。



![](img/50b76bf8c477b208a834e72d4141c649_68.png)

助教是保罗，布淀粉。

![](img/50b76bf8c477b208a834e72d4141c649_70.png)

张凯蒂，你会注意到这里有几个标签，我们也可以点击查看其他东西。

![](img/50b76bf8c477b208a834e72d4141c649_72.png)

所以如果我们点击数据库，我们可以看到我们对数据库提出的最后一个问题。

![](img/50b76bf8c477b208a834e72d4141c649_74.png)

以及我们从那里得到的消息，这些是文件。

![](img/50b76bf8c477b208a834e72d4141c649_76.png)

这些是在分裂发生后，这些是我们检索到的每个块，我们可以看到带有输入和输出的聊天历史记录。

![](img/50b76bf8c477b208a834e72d4141c649_78.png)

然后还有一个地方来配置它，在那里你可以上传文件。

![](img/50b76bf8c477b208a834e72d4141c649_80.png)

我们也可以要求跟进，所以让我们问问他们的专业是什么。

![](img/50b76bf8c477b208a834e72d4141c649_82.png)

我们得到了关于前面提到的TA的答案，我们可以看到保罗正在学习机器学习和计算机视觉，凯蒂其实是个神经学家。



![](img/50b76bf8c477b208a834e72d4141c649_84.png)

这节课基本上就结束了，所以现在是暂停的好时机，再问它一堆问题，在这里上传您自己的文档，享受这个端到端的问题回答机器人，配有令人惊叹的笔记本UI，这就结束了与您的数据进行车道链聊天的课程，在这门课上。

我们已经介绍了如何使用链接链从各种文档源加载数据，使用链接链，80多个不同的文档加载器，从那里我们把文件分成几块，并谈论许多这样做的细微差别，然后我们把这些大块，为它们创建嵌入，把它们放进矢量仓库。

展示了如何轻松地启用语义搜索，但我们也讨论了语义搜索的一些缺点，它可能在某些边缘失败的地方出现下一件事，我们涵盖的是检索，可能是我最喜欢的部分，在那里我们讨论了许多新的、先进的、非常有趣的检索算法。

为了克服这些边缘情况，我们在下一次会议上把它和llms结合起来，我们把那些检索到的文件，我们接受用户的问题，我们把它交给一个LLM，我们对最初的问题产生一个答案，但还缺一样东西，这是它的对话方面。

我们就在那里上完了课，通过在数据上创建一个功能齐全的端到端聊天机器人，我真的很喜欢教这门课，我希望你们喜欢，我要感谢开源领域的每一个人，他为这门课的成功做出了很多贡献。

就像你看到的所有提示和许多功能一样，当你们和朗链一起建造的时候，并发现新的做事方式、新的技巧和技巧，我希望你在推特上分享你所学到的东西，甚至在链接链中开设公关，这是一个变化非常快的领域。

这是一个激动人心的时刻。

![](img/50b76bf8c477b208a834e72d4141c649_86.png)