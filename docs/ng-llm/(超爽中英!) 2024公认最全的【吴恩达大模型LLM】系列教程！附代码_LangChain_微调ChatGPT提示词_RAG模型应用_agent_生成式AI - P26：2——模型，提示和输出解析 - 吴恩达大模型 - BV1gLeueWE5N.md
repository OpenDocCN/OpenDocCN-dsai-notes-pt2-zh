# (超爽中英!) 2024公认最全的【吴恩达大模型LLM】系列教程！附代码_LangChain_微调ChatGPT提示词_RAG模型应用_agent_生成式AI - P26：2——模型，提示和输出解析 - 吴恩达大模型 - BV1gLeueWE5N

![](img/33b34f27f891ee6bcb7f740a22b7da9c_0.png)

在第一节课中。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_2.png)

我们将学习模型，提示和解析器，所以模型指的是语言模型，它支撑了其中的大部分，提示指的是创建输入的风格，这些输入将被传递给模型，然后解析器在相反的一端，它涉及到将这些模型的输出解析为更结构化的格式。

以便你可以在下游做 things，所以当你使用 lm 构建一个应用时，他们往往会使用可重用的模型，我们反复提示一个模型，解析输出，因此，启动提供了一种简单的抽象方式来执行这种操作，所以，让我们开始。

看一看模型的提示和暂停，所以，要开始。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_4.png)

这里有一些起始代码，我将导入os，import openai并加载我的openai秘密键，openai库已经安装在我的jupyter notebook环境中。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_6.png)

如果你在本地运行这个，并且还没有安装open ai。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_8.png)

你可能需要运行那个pip，安装open ai。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_10.png)

但我在这里不会去做那个，然后这里是一个助手函数，这实际上非常类似于你可能在聊天中看到的助手函数，Gpt prom工程为开发者，与我一起提供的课程是fulford。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_12.png)

因此，使用此助手函数，您可以说完成什么等于一加一。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_14.png)

这将调用try gpc，或技术上，模型gpt三点五涡轮以给您一个回答，现在像这样来激励线链。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_16.png)

模型提示和暂停的抽象。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_18.png)

假设你收到一封来自非英语客户的电子邮件。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_20.png)

嗯，为了确保这是可访问的，我将使用的其他语言是英语海盗语言。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_22.png)

当涉及到R时，我会大发脾气，那盖子飞开了，把我的厨房墙壁洒满了奶昔。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_24.png)

而且事情变得更糟，保修不覆盖清理厨房的成本。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_26.png)

我现在需要你的帮助，伙计，所以我们将让这個lm將文本翻译成美式英语。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_28.png)

以平静和尊重的语气，所以我将设置样式为美式英语，以常见和尊重的语气，因此，为了实际完成这个任务。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_30.png)

如果你以前见过一点提示，我将使用f字符串来指定提示，包含指示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_32.png)

将三引号分隔的文本翻译成样式为style。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_34.png)

然后插入这两种风格，因此，这生成一个提示说。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_36.png)

翻译文本，等等。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_38.png)

我鼓励您暂停视频并运行代码，也尝试修改提示，看看是否能得到不同的结果。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_40.png)

你可以。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_42.png)

然后，嗯，提示大型语言模型获取响应。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_44.png)

让我们看看响应是什么，所以它将英语海盗的信息翻译成这种非常礼貌的。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_46.png)

我真的很沮丧，我的搅拌机盖子飞走了。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_48.png)

在厨房墙上造成了一团糟，所以，果汁，等等，我现在真的很需要你的帮助。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_50.png)

听起来非常友好的朋友，所以，如果你有不同的客户用不同的语言写评论。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_52.png)

不仅仅是英语海盗，但法语，德语。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_54.png)

日语等等，你可以想象需要生成一系列提示来生成这样的翻译。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_56.png)

让我们看看如何更方便地做到这一点，使用lang chain。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_58.png)

我将导入chat openai，这是lang cha对chat gpt api端点的抽象。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_60.png)

如果我然后说等于chat openai并看什么chat是。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_62.png)

它创建了这个对象如下，它使用chat gpt模型，也被称为gpt 3。5 turbo。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_64.png)

当我构建应用程序时，我会经常设置温度参数等于零。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_66.png)

所以默认温度是0。7，但我实际上重新做那个，温度，等于0。0，现在，温度被设置为0，以使其输出稍微不那么随机。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_68.png)

![](img/33b34f27f891ee6bcb7f740a22b7da9c_69.png)

现在，让我定义模板字符串如下。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_71.png)

将文本翻译成风格，风格由三重动作定义，然后这里是文本。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_73.png)

为了重复使用此模板，我将导入lang chains，Chat prompt template。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_75.png)

然后，让我使用上面写的模板字符串创建提示模板。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_77.png)

![](img/33b34f27f891ee6bcb7f740a22b7da9c_78.png)

从提示模板，实际上可以从中提取原始提示，它意识到这个提示有两个输入变量，风格和文本，在这里以括号显示。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_80.png)

并且这里是我们实际上指定的原始模板，也打印出来。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_82.png)

嗯，它意识到有两个输入变量。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_84.png)

风格和文本，现在，让我们指定风格，这是我想要客户消息翻译成的风格，所以我将称此为客户风格，这是我的先前客户电子邮件，现在这样。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_86.png)

如果我创建自定义消息，这将生成提示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_88.png)

我们将将这个，在一分钟后传递给大型语言模型以获取响应，所以如果你想查看类型，自定义消息实际上是一个列表，嗯。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_90.png)

如果你看列表的第一个元素，这是大约您期望创建此消息时将生成的提示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_92.png)

让我们将这个提示传递给lm。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_94.png)

所以我将调用聊天，我们之前说过，嗯，作为对openai gpt端点的参考。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_96.png)

如果我们打印出客户响应的内容，那么它将返回，嗯，这是从英语海盗翻译成礼貌的美国英语的文本，当然，你可以想象其他用例，其中客户电子邮件是其他语言。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_98.png)

这两个可以用于为英语翻译消息。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_100.png)

以理解和回复，我鼓励你暂停视频并运行代码，也尝试修改提示，看看能否得到不同的结果现在。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_102.png)

让我们希望我们的客户服务代表以原始语言回复了客户。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_104.png)

所以让我们说，英语说者，客户服务代表起身，说嗨那里，客户保修不涵盖您厨房清洁费用的费用，因为它是你滥用搅拌机的错误，通过叉子在盖子上，运气不好，再见，不是一个很礼貌的消息。

但让我们说这是客户服务代表想要的。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_106.png)

我们将指定，服务消息将被翻译成这个海盗风格，所以我们想要它以英语海盗的语气说，语气礼貌，因为我们之前创建了那个提示模板。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_108.png)

有趣的是，我们现在可以重用那个提示模板，并指定我们想要输出的是这个海盗服务风格，并且文本是这个服务回复，如果我们这样做。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_110.png)

这就是提示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_112.png)

如果我们提示，嗯 chagpt t。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_114.png)

这就是它给我们返回的响应，我必须为你来，保修不覆盖费用或清洁你的厨房等。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_116.png)

运气不好，法老，热心肠，所以你可能会好奇。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_118.png)

我们为什么使用提示模板而不是，你知道，只是一个f字符串，答案是因为你在建立复杂的应用程序时，提示可以非常长且详细。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_120.png)

因此，提示模板是一种有用的抽象，可以帮助你重复使用好提示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_122.png)

当你可以，嗯，这是一个相对较长的提示示例，为了评估在线学习应用程序中的学生提交。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_124.png)

像这样的问题可以非常长，在其中，你可以要求lm首先解决这个问题，然后，输出格式为某种格式，输出格式也为某种格式。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_126.png)

并将此包裹在lang chain中，提示使得重复使用这样的提示变得更加容易。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_128.png)

你也看到后来，语言链为某些常见操作提供了提示，例如，摘要或问题解答，或者连接到SQL数据库。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_130.png)

或者连接到不同的API，因此，通过使用一些内置在语言链中的提示，你可以快速得到一个应用程序工作，而不需要。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_132.png)

设计和构建自己的提示，语言链的提示库的另一个方面是它也支持输出解析，我们将在下一分钟讲到，但是，当你在使用llm构建复杂的应用时，你经常指示lm以特定的格式生成其输出，例如，使用特定的关键词。

左边的这个例子展示了如何使用llm执行被称为链式思考的事情，推理，使用被称为react框架的框架，但不用担心技术细节，但关键的是，想法是lm正在思考的，因为通过给lm留出思考的空间。

它往往可以得出更准确的结论，然后使用行动作为关键词来执行特定的行动，然后观察来显示从那个行动中学到的东西，就这样，如果你有一个提示，它指示lm使用这些特定的关键词，思考，行动和观察。

然后这个提示可以与一个解析器结合，来提取出被标记为这些特定关键词的文本，这样一起就给出了一个非常漂亮的抽象，来指定lm的输入，然后，也要有一个解析器正确地解释lm给出的输出，因此。

让我们回到看到使用lang chain的输出解析器的例子。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_134.png)

在这个例子中，让我们看看如何让您的lm输出为json，并使用line chain传递该输出。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_136.png)

为了运行我将使用的示例，将是从产品评论中提取信息并将该输出格式化为相邻格式。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_138.png)

所以，这里是您希望输出格式化的技术示例。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_140.png)

这是一个Python字典，其中表示产品是否为礼物，映射为false，它花费的天数，送货员是五，并且价格价值相当实惠，所以，这是一个想要的输出示例。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_142.png)

这里是一个客户评论。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_144.png)

以及一个尝试获取json输出的模板，所以，这是一个客户评论，它说睡眠模糊非常棒，它有四个设置，蜡烛吹风机，性别，微风，风城和龙卷风，两天后到达，正好赶上我妻子的生日礼物，我认为我的妻子非常喜欢。

到目前为止她都沉默了，我一直在使用它，等等，这里是根据以下文本的评论模板，从信息中提取，这是否是礼物，所以在这种情况下将是yes，因为这是礼物，嗯，而且也是送货天数，它花了多长时间送达，看起来。

在这种情况下它两天后到达，什么价格价值，你知道，在跳跃期间稍微贵一些，吹风机等。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_146.png)

所以，评论模板是lm要作为输入的，一个客户评论，并提取这三个字段，然后格式化输出为json，嗯，使用以下键。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_148.png)

好的，所以，这就是如何将此包装在lang chain中。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_150.png)

让我们导入聊天提示模板，我们实际上 earlier 就已经导入了这个，所以从技术上讲，这行代码是多余的，但我还是会再次导入它，然后从评论模板创建提示模板，放在顶部。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_152.png)

这就是提示模板。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_154.png)

现在，类似于我们 earlier 对提示模板的使用，让我们创建要传递给 open eye 的消息，嗯，终点，对待 open air 终点，调用那个端点，然后让我们打印出响应，我鼓励你暂停视频并运行代码。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_156.png)

![](img/33b34f27f891ee6bcb7f740a22b7da9c_157.png)

这就是它，它说，如果为真，这是二，而且价格值看起来也很准确。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_159.png)

嗯，但请注意，如果我们检查类型。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_161.png)

响应中的这一部分，实际上这是一个字符串，所以它看起来像json，并且看起来像有键值对，但实际上它不是一个字典，这只是一个长长的字符串。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_163.png)

所以我真正想做的是去响应内容中获取键的值。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_165.png)

如果键，这应该是真的，但我运行这个，这应该生成一个错误，因为。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_167.png)

这实际上是一个字符串，这不是一个Python字典，所以让我们看看如何使用lang chains在解析器中。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_169.png)

为了做到这一点。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_171.png)

我将导入，响应schema和结构化输出解析器从lang chain，并且我将告诉它。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_173.png)

我想要暂停，通过指定这些响应schema。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_175.png)

所以礼物方案的名称是礼物，这里是描述：该物品购买用于为他人购买礼物。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_177.png)

回答真或是，假，如果不是如此未知。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_179.png)

等等，所以有一个好方案，配送一个方案价格值方案，然后让我们将这三个都放入一个列表如下。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_181.png)

现在我已经指定了这些启动的方案，实际上可以给您提示本身，通过拥有积极的输出，告诉你它想要你发送给lm的指令，所以如果我要打印格式指令，她对lm有非常精确的指令，这将导致它生成输出，输出解析器可以处理。

所以这里是一个新的评论模板。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_183.png)

并且评论模板包括lang chain生成的格式指令。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_185.png)

![](img/33b34f27f891ee6bcb7f740a22b7da9c_186.png)

因此我们可以从评论模板中创建两个提示。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_188.png)

然后创建将传递到openai端点的消息。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_190.png)

如果你想，你可以查看实际的提示，这是给出提取保险丝的指令，如果交货日期，价格值，这里是文本，然后这里是格式化指令，最后，如果我们调用open ai端点，让我们看看我们得到的响应，现在是这个。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_192.png)

现在如果我们使用我们创建的输出解析器。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_194.png)

那么你可以 earlier 将此传递给一个输出字典。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_196.png)

按区域打印看起来像这样，请注意这是大写字母的字典。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_198.png)

![](img/33b34f27f891ee6bcb7f740a22b7da9c_199.png)

不是字符串，这就是我为什么现在可以提取与键 gift 相关的值并得到 true，或与交付日期相关的值并得到 two。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_201.png)

或你也可以提取与价格值相关的值。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_203.png)

所以这是一种聪明的方法来处理你的 lm 输出。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_205.png)

并将其解析为 Python 字典。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_207.png)

以使输出在下游处理中更容易使用，我鼓励你暂停视频并运行代码，这就是关于模型的全部，使用这些工具进行提示和解析，希望你能够重用自己的自定义提示模板，很容易，与他人分享提示模板，与你合作的人。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_209.png)

甚至可以使用内置于提示模板的语言链，正如你刚刚看到的，这些通常可以与输出解析器结合使用，以便将输入提示以特定格式输出。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_211.png)

然后，解析器暂停该输出以将数据存储在Python字典中，或者一些其他数据结构，使它对下游处理更加方便。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_213.png)

我希望这在您许多应用中都有用处。

![](img/33b34f27f891ee6bcb7f740a22b7da9c_215.png)

那么，让我们去看下一个视频，在那里，我们将看到如何利用lanking帮助您构建更好的聊天机器人，或者有一个lm，进行更有效的聊天。



![](img/33b34f27f891ee6bcb7f740a22b7da9c_217.png)