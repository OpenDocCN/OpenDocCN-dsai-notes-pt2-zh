#  【LangChain大模型应用开发】DeepLearning.AI - P7：7——代理 - 吴恩达大模型 - BV1iZ421M79T

![](img/3ff7beb031a24989fc152622b2092ecc_0.png)

有时人们认为大语言模型是知识库，有时人们认为大语言模型是知识库，因为它学习记忆大量信息，因为它学习记忆大量信息，可能来自互联网，可能来自互联网，当你提问时，当你提问时，它能回答问题，它能回答问题。

但更实用的看法是将其视为推理引擎，但更实用的看法是将其视为推理引擎，你可以给它文本块或其他信息源，你可以给它文本块或其他信息源，然后大型语言模型（LM），然后大型语言模型（LM）。

可能使用从互联网学到的背景知识，可能使用从互联网学到的背景知识，来回答问题，来回答问题，用你提供的新信息回答问题或推理内容，用你提供的新信息回答问题或推理内容，或决定下一步做什么，或决定下一步做什么。

这就是lang chain的代理框架帮助你做的，这就是lang chain的代理框架帮助你做的，代理可能是我最喜欢lang chain的部分，代理可能是我最喜欢lang chain的部分。

我认为它们也是最有力的部分，我认为它们也是最有力的部分，但它们也是较新的部分，但它们也是较新的部分，因此，我们在这里看到很多新东西，因此，我们在这里看到很多新东西，这对该领域的每个人来说都是全新的。

这对该领域的每个人来说都是全新的，因此，这应该是一堂非常令人兴奋的课程，因此，这应该是一堂非常令人兴奋的课程，当我们深入研究代理是什么以及如何创建时，当我们深入研究代理是什么以及如何创建时。

如何使用代理，如何使用代理，如何装备不同工具，如内建语言链的搜索引擎，如何装备不同工具，如内建语言链的搜索引擎，以及如何创建自己的工具，以及如何创建自己的工具，这样可以让代理与任何数据存储交互。

这样可以让代理与任何数据存储交互，任何API，任何API，任何可能需要的函数，任何可能需要的函数，这是令人兴奋的前沿技术，这是令人兴奋的前沿技术，但已有重要的应用案例，但已有重要的应用案例。

那么让我们深入探讨，那么让我们深入探讨，首先，首先，我们将设置环境变量，我们将设置环境变量，并导入稍后使用的许多东西，并导入稍后使用的许多东西。



![](img/3ff7beb031a24989fc152622b2092ecc_2.png)

我们将初始化语言模型，我们将初始化语言模型。

![](img/3ff7beb031a24989fc152622b2092ecc_4.png)

我们将使用Chat Open AI，重要的是，我们将使用Chat Open AI，重要的是，我们将温度设置为0，我们将温度设置为0。



![](img/3ff7beb031a24989fc152622b2092ecc_6.png)

这很重要，这很重要，因为我们将使用语言模型作为代理的推理引擎，因为我们将使用语言模型作为代理的推理引擎，它与其他数据和计算源连接，它与其他数据和计算源连接。



![](img/3ff7beb031a24989fc152622b2092ecc_8.png)

因此我们希望这个推理引擎尽可能好和精确，因此我们希望这个推理引擎尽可能好和精确，因此我们将它设置为0，因此我们将它设置为0，消除任何可能出现的不确定性，消除任何可能出现的不确定性，接下来加载一些工具。

接下来加载一些工具，将加载两个工具：llm数学工具和维基百科工具，将加载两个工具：llm数学工具和维基百科工具。



![](img/3ff7beb031a24989fc152622b2092ecc_10.png)

llm数学工具实际上是一个链本身，llm数学工具实际上是一个链本身，结合语言模型和计算器解决数学问题，结合语言模型和计算器解决数学问题。



![](img/3ff7beb031a24989fc152622b2092ecc_12.png)

维基百科工具是一个API，连接到维基百科，维基百科工具是一个API，连接到维基百科，允许您对维基百科运行搜索查询并获取结果，允许您对维基百科运行搜索查询并获取结果。



![](img/3ff7beb031a24989fc152622b2092ecc_14.png)

接下来初始化一个代理，接下来初始化一个代理，将使用工具初始化代理，将使用工具初始化代理。

![](img/3ff7beb031a24989fc152622b2092ecc_16.png)

语言模型，语言模型，这里将使用聊天零射反应描述代理类型，这里将使用聊天零射反应描述代理类型。

![](img/3ff7beb031a24989fc152622b2092ecc_18.png)

注意首先聊天，注意首先聊天，这是一个优化与聊天模型合作的代理，这是一个优化与聊天模型合作的代理。

![](img/3ff7beb031a24989fc152622b2092ecc_20.png)

其次反应，其次反应，这是一种设计用于从语言模型中获得最佳推理性能的提示技术，这是一种设计用于从语言模型中获得最佳推理性能的提示技术。



![](img/3ff7beb031a24989fc152622b2092ecc_22.png)

还将传入处理错误等于真，还将传入处理错误等于真。

![](img/3ff7beb031a24989fc152622b2092ecc_24.png)

当语言模型可能输出无法解析的内容时，这很有用，当语言模型可能输出无法解析的内容时，这很有用，嗯，嗯，无法解析为动作和动作输入，无法解析为动作和动作输入。



![](img/3ff7beb031a24989fc152622b2092ecc_26.png)

这是期望的输出，这是期望的输出，当这种情况发生时，当这种情况发生时。

![](img/3ff7beb031a24989fc152622b2092ecc_28.png)

实际上会将格式错误的文本返回给语言模型，实际上会将格式错误的文本返回给语言模型，并要求它纠正自己，并要求它纠正自己。



![](img/3ff7beb031a24989fc152622b2092ecc_30.png)

最后将传入详细等于真，最后将传入详细等于真，这将在Jupyter笔记本中打印出许多步骤，使我们非常清楚，这将在Jupyter笔记本中打印出许多步骤，使我们非常清楚，正在发生什么，正在发生什么。

稍后将在笔记本的全球级别设置调试等于真，稍后将在笔记本的全球级别设置调试等于真。

![](img/3ff7beb031a24989fc152622b2092ecc_32.png)

以便我们可以更详细地了解到底发生了什么，以便我们可以更详细地了解到底发生了什么，首先我们将向代理询问一个数学问题，首先我们将向代理询问一个数学问题，三百的百分之二十五是多少，三百的百分之二十五是多少。



![](img/3ff7beb031a24989fc152622b2092ecc_34.png)

这是一个相当简单的问题，这是一个相当简单的问题，但将有助于我们理解正在发生什么，但将有助于我们理解正在发生什么，因此，我们可以看到，当它进入代理执行链时，因此，我们可以看到，当它进入代理执行链时。



![](img/3ff7beb031a24989fc152622b2092ecc_36.png)

它首先考虑需要做什么，它首先考虑需要做什么。

![](img/3ff7beb031a24989fc152622b2092ecc_38.png)

所以它有一个想法，所以它有一个想法。

![](img/3ff7beb031a24989fc152622b2092ecc_40.png)

然后它有一个动作，然后它有一个动作，这个动作实际上是一个JSON blob，对应两个东西，这个动作实际上是一个JSON blob，对应两个东西，一个动作和一个动作输入，一个动作和一个动作输入。

动作对应要使用的工具，动作对应要使用的工具。

![](img/3ff7beb031a24989fc152622b2092ecc_42.png)

所以这里是计算器，所以这里是计算器，动作输入是该工具的输入，动作输入是该工具的输入。

![](img/3ff7beb031a24989fc152622b2092ecc_44.png)

这里是一个300乘以0。25的字符串，这里是一个300乘以0。25的字符串，接下来我们可以看到有一个带有答案的观察，颜色不同，接下来我们可以看到有一个带有答案的观察，颜色不同。



![](img/3ff7beb031a24989fc152622b2092ecc_46.png)

这个观察答案等于75。0实际上是来自计算器工具本身，这个观察答案等于75。0实际上是来自计算器工具本身。



![](img/3ff7beb031a24989fc152622b2092ecc_48.png)

接下来我们回到语言模型，接下来我们回到语言模型，当文本变成绿色时，当文本变成绿色时。

![](img/3ff7beb031a24989fc152622b2092ecc_50.png)

我们有问题的答案，我们有问题的答案，最终答案，最终答案，75。0，75。0，这是我们得到的输出，这是我们得到的输出，现在是一个暂停并尝试自己不同数学问题的好时机。

现在是一个暂停并尝试自己不同数学问题的好时机，接下来我们将通过Wikipedia API的例子，接下来我们将通过Wikipedia API的例子，这里我们将问你关于汤姆·米切尔的问题。

这里我们将问你关于汤姆·米切尔的问题。

![](img/3ff7beb031a24989fc152622b2092ecc_52.png)

我们可以查看中间步骤来了解它做了什么，我们可以查看中间步骤来了解它做了什么。

![](img/3ff7beb031a24989fc152622b2092ecc_54.png)

我们可以再次看到它思考，我们可以再次看到它思考。

![](img/3ff7beb031a24989fc152622b2092ecc_56.png)

并且它正确地意识到应该使用Wikipedia，并且它正确地意识到应该使用Wikipedia，它说动作等于Wikipedia，动作输入等于汤姆·米切尔，它说动作等于Wikipedia。

动作输入等于汤姆·米切尔。

![](img/3ff7beb031a24989fc152622b2092ecc_58.png)

这次观察以黄色返回，我们使用不同的颜色来表示不同的工具，这次观察以黄色返回，我们使用不同的颜色来表示不同的工具，注意首先聊天，注意首先聊天，这是一个优化与聊天模型合作的代理。

这是一个优化与聊天模型合作的代理，维基百科汤姆·米切尔页面的总结结果，维基百科汤姆·米切尔页面的总结结果，从维基百科返回的观察结果是两个结果，从维基百科返回的观察结果是两个结果，两个页面，两个页面。

因为有两位不同的汤姆·米切尔，因为有两位不同的汤姆·米切尔，我们可以看到第一个页面涵盖了计算机科学家，我们可以看到第一个页面涵盖了计算机科学家，第二个页面，第二个页面，看起来是一位澳大利亚足球运动员。

看起来是一位澳大利亚足球运动员，我们可以看到需要回答这个问题的信息，我们可以看到需要回答这个问题的信息，即他写的那本书的名字，即他写的那本书的名字，机器学习出现在第一个汤姆·米切尔的摘要中。

机器学习出现在第一个汤姆·米切尔的摘要中，我们可以看到接下来代理试图查找更多关于这本书的信息，我们可以看到接下来代理试图查找更多关于这本书的信息，所以它查找了维基百科上的机器学习书籍。

所以它查找了维基百科上的机器学习书籍，这并不严格必要，这并不严格必要，这是一个有趣的例子，展示了代理并不完全可靠，这是一个有趣的例子，展示了代理并不完全可靠，但我们可以看到在这次查找之后。

但我们可以看到在这次查找之后，代理意识到它已经拥有所有需要回答的信息，代理意识到它已经拥有所有需要回答的信息，并回答了正确的答案，并回答了正确的答案，机器学习，机器学习。

接下来我们要看的是一个很酷的例子，接下来我们要看的是一个很酷的例子，如果你见过像Copilot或带有代码解释器插件的Chat GPT，如果你见过像Copilot或带有代码解释器插件的Chat GPT。



![](img/3ff7beb031a24989fc152622b2092ecc_60.png)

他们正在使用语言模型编写代码，他们正在使用语言模型编写代码，然后执行该代码，然后执行该代码。

![](img/3ff7beb031a24989fc152622b2092ecc_62.png)

我们在这里可以做完全相同的事情，我们在这里可以做完全相同的事情，所以我们要创建一个Python代理，所以我们要创建一个Python代理，并且我们将使用之前相同的LLM，并且我们将使用之前相同的LLM。

我们将给它一个工具，我们将给它一个工具，Python REPL工具，Python REPL工具，REPL基本上是一种与代码交互的方式，REPL基本上是一种与代码交互的方式。

你可以把它想象成一个Jupyter笔记本，你可以把它想象成一个Jupyter笔记本，所以代理可以使用这个REPL执行代码，所以代理可以使用这个REPL执行代码，它将运行，它将运行。



![](img/3ff7beb031a24989fc152622b2092ecc_64.png)

然后我们会得到一些结果，这些结果将被返回给代理，然后我们会得到一些结果，这些结果将被返回给代理，所以它可以决定接下来做什么，所以它可以决定接下来做什么。



![](img/3ff7beb031a24989fc152622b2092ecc_66.png)

我们要让这个代理解决的问题是，我们要让这个代理解决的问题是。

![](img/3ff7beb031a24989fc152622b2092ecc_68.png)

我们将给它一个名字列表，我们将给它一个名字列表，然后要求它按姓氏排序，然后要求它按姓氏排序，所以你可以看到这里，所以你可以看到这里。



![](img/3ff7beb031a24989fc152622b2092ecc_70.png)

我们有一个名字列表，我们有一个名字列表，哈里森，哈里森，蔡斯，蔡斯，语言链LLM，语言链LLM，杰夫，杰夫，融合变压器，融合变压器，生成AI，生成AI。



![](img/3ff7beb031a24989fc152622b2092ecc_72.png)

我们将要求代理首先按姓氏排序这些名字，我们将要求代理首先按姓氏排序这些名字，然后按名字排序，然后按名字排序。



![](img/3ff7beb031a24989fc152622b2092ecc_74.png)

然后打印输出，然后打印输出，重要的是我们要求它打印输出，重要的是我们要求它打印输出，这样它实际上可以看到结果是什么，这样它实际上可以看到结果是什么。



![](img/3ff7beb031a24989fc152622b2092ecc_76.png)

以便它可以决定接下来做什么，以便它可以决定接下来做什么。

![](img/3ff7beb031a24989fc152622b2092ecc_78.png)

这些打印的语句稍后将回传给语言模型，以便它能推理刚运行的代码的输出。

![](img/3ff7beb031a24989fc152622b2092ecc_80.png)

让我们试试，进入代理执行链时。

![](img/3ff7beb031a24989fc152622b2092ecc_82.png)

它首先意识到可以使用sorted函数列出客户。

![](img/3ff7beb031a24989fc152622b2092ecc_84.png)

![](img/3ff7beb031a24989fc152622b2092ecc_85.png)

内部使用了不同类型的代理，这就是为什么动作和动作输入的格式略有不同，这里，它采取的行动是使用Python REPL，你可以看到动作输入实际上是代码，首先写出客户，等于这个列表，然后对客户排序。

然后遍历这个列表并打印。

![](img/3ff7beb031a24989fc152622b2092ecc_87.png)

你可以看到，代理考虑要做什么并意识到需要编写一些代码，动作和动作输入的格式与之前略有不同。

![](img/3ff7beb031a24989fc152622b2092ecc_89.png)

它使用的是内部不同的代理类型来执行动作，它将使用Python REPL，对于动作输入，它将有一堆代码，所以如果我们看看这段代码在做什么，它首先创建一个变量来列出这些客户名称。

然后对它排序并创建一个新的变量。

![](img/3ff7beb031a24989fc152622b2092ecc_91.png)

然后遍历这个新变量并打印每行。

![](img/3ff7beb031a24989fc152622b2092ecc_93.png)

就像我们要求它做的，我们可以看到我们得到了观察结果，这是一个名字列表。

![](img/3ff7beb031a24989fc152622b2092ecc_95.png)

然后代理意识到它完成了并返回这些名称，从打印出的内容中，我们可以看到正在发生的高层情况。

![](img/3ff7beb031a24989fc152622b2092ecc_97.png)

但让我们深入一点并使用lane chain debug运行，设置为true，因为这会打印出所有不同链的所有级别的所有内容，让我们看看它们到底在做什么，所以首先我们从代理执行器开始，这是顶级代理运行器。

我们可以看到我们这里有，我们的输入，按姓氏和名字排序客户，然后打印输出，从这里我们调用一个llm链。

![](img/3ff7beb031a24989fc152622b2092ecc_99.png)

这是代理使用的lm链，所以lm链记得提示和lms的组合，此时它只在代理草稿中有输入，我们稍后会回到这一点，以及一些停止序列来告诉语言模型何时停止生成，在下一级，我们看到对语言模型的确切调用。

所以我们可以看到完全格式的提示，它包括关于它可访问的工具的说明以及如何格式化其输出的说明，然后可看到语言模型的确切输出，可以看到文本键，含思考、动作和动作，并将所有放入一个字符串。

它通过那里结束llm链，接下来它调用一个工具，可以看到工具的确切输入。

![](img/3ff7beb031a24989fc152622b2092ecc_101.png)

也可以看到工具的名称，Python repl，然后可以看到输入，即这段代码，然后可查看此工具输出，即打印出的字符串，再次，这是因为特意让Python REPL输出发生了什么。

然后可查看LM链的下一个输入，再次，这里的LM链是代理，所以，看变量，输入不变，这是要求的高层目标，但现在代理草稿有一些新值，可以看到，这是前代与工具输出的结合，然后我们将其传回。

以便语言模型理解之前发生了什么，并据此推理下一步该做什么，接下来的几行打印语句涵盖了，语言模型意识到它基本上完成了任务时会发生什么，所以我们可以看到，这是给语言模型的完全格式化提示。

它意识到完成时的响应。

![](img/3ff7beb031a24989fc152622b2092ecc_103.png)

并说最终答案，这里是指代理用于识别其已完成工作的序列，然后我们可以看到它退出llm链，然后退出代理执行器，这应该能让你大致了解，在这些代理内部。



![](img/3ff7beb031a24989fc152622b2092ecc_105.png)

这应该能让你大致了解，并希望有指导意义，当你暂停并设定，自己的编码代理目标。

![](img/3ff7beb031a24989fc152622b2092ecc_107.png)

尝试完成时，调试模式也可用于。

![](img/3ff7beb031a24989fc152622b2092ecc_109.png)

突出显示问题所在，如上所示的维基百科示例。

![](img/3ff7beb031a24989fc152622b2092ecc_111.png)

目前我们使用了LinkedIn已有的工具。

![](img/3ff7beb031a24989fc152622b2092ecc_113.png)

但代理的一大优势是，你可以将其连接到自己的信息源，你自己的API，你自己的数据。

![](img/3ff7beb031a24989fc152622b2092ecc_115.png)

接下来，我们将介绍如何创建自定义工具，这样你就可以将其连接到你想要的一切。

![](img/3ff7beb031a24989fc152622b2092ecc_117.png)

首先，让我们制作一个工具，告诉我们当前日期。

![](img/3ff7beb031a24989fc152622b2092ecc_119.png)

我们将导入此工具装饰器，这可以应用于任何函数，并将其转换为LinkedIn可以使用的工具。

![](img/3ff7beb031a24989fc152622b2092ecc_121.png)

我们要写一个函数，叫time，它在任何文本字符串中震动，我们实际上不会使用它，它将通过调用date time返回今天的日期。



![](img/3ff7beb031a24989fc152622b2092ecc_123.png)

除了函数名外，我们还将编写一个非常详细的文档字符串。

![](img/3ff7beb031a24989fc152622b2092ecc_125.png)

因为这就是代理将用来知道何时应该调用此工具的原因。

![](img/3ff7beb031a24989fc152622b2092ecc_127.png)

以及如何调用此工具，例如，这里我们说输入应该始终为空字符串，因为我们不使用它，如果我们对输入应该有更严格的要求。



![](img/3ff7beb031a24989fc152622b2092ecc_129.png)

例如，如果我们有一个函数应该始终接受搜索查询或SQL语句。

![](img/3ff7beb031a24989fc152622b2092ecc_131.png)

您将希望确保在这里提及这一点，我们现在将创建另一个代理，这次我们将时间工具添加到现有工具列表中。

![](img/3ff7beb031a24989fc152622b2092ecc_133.png)

最后让我们调用代理并询问它今天的日期。

![](img/3ff7beb031a24989fc152622b2092ecc_135.png)

它认识到需要使用时间工具，它在这里指定，它有动作输入为空字符串，这很好，这是我们告诉它要做的，然后它返回一个观察结果，然后最终语言模型取该观察结果并响应用户，今天是2023年，05月，21日。

你应该在这里暂停视频并尝试不同的输入，这结束了关于代理的课程，这是长链中较新、更令人兴奋和更实验性的一部分，所以我希望你喜欢使用它，希望它向您展示了如何使用语言模型作为推理引擎。



![](img/3ff7beb031a24989fc152622b2092ecc_137.png)