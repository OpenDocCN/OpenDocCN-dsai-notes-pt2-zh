# 【大模型微调】 DeepLearning.AI - P3：3-微调在训练过程中的位置 - 吴恩达大模型 - BV1mT421a78i

在这节课中，您将了解微调真正适合培训过程的地方，它是在一个叫做预训练的步骤之后出现的，这将涉及到一点细节，然后你就可以学习所有不同的任务，你得把微调应用到，我们继续好吗，让我们先看看微调适合哪里。



![](img/b46c7ab563229c69723d79f17ee24102_1.png)

让我们来看看预训练，这是微调发生之前的第一步，它实际上在一开始就需要一个模型，那完全是随机的，它对世界一无所知，所以它所有的重量，如果你熟悉权重是完全随机的，它根本不能构成英语单词，它还没有语言技能。

它的学习目标是下一个令牌预测，或者真的，你知道的，在简化的意义上，只是这里的下一个词预测，所以你看到这个词一次，所以我们希望它现在，预测这个词，但你会看到LLM只是产生SD感叹号，感叹号离这个词很远。

原来在那里，但它正在接收和读取一个巨大的数据语料库，经常从整个网络上刮下来，我们通常称之为无标签，因为这不是我们共同构建的。



![](img/b46c7ab563229c69723d79f17ee24102_3.png)

我们刚从网上刮下来的，我会说它经历了很多很多的清洁过程，所以要得到这个数据集还有很多手工工作要做，对模型预训练有效，因为模型本质上是用下一个令牌预测来监督自己，它所要做的就是预测下一个词。

没有真正的标签，否则，在这里训练后，您可以看到，模型现在能够预测单词on或令牌，或在，嗯，这是习得的语言，它从网上学到了很多知识，所以这个过程实际上是以这种方式工作的，这太棒了，而且很神奇。

因为它只是试图预测下一个令牌，它现在正在读取整个互联网的数据来这样做。

![](img/b46c7ab563229c69723d79f17ee24102_5.png)

好啦，也许整个互联网上都有星号，从整个互联网上刮取的数据和数据，这背后的实际理解和知识往往不是很公开，人，我真的不知道数据集是什么样子的，对于许多大公司的闭源模型来说，但是路德有一个惊人的开源努力。

人工智能将创建一个名为桩的数据集，你将在这个实验室里探索，它是一套两个，从整个互联网上刮取的两个不同的数据集，在这张图中你可以看到，你知道有八十七年，这是林肯的葛底斯堡演说，还有林肯的胡萝卜蛋糕食谱。

当然还有从Pubmed上刮下来的，有关于不同医学文本的信息，最后，这里还有来自GitHub的代码，所以这是一组非常聪明的数据集，它们被精心策划在一起，为这些模型注入知识，现在呢。

这个预培训步骤是相当昂贵的，耗时实际上是昂贵的，因为模型太费时间了，检查所有这些数据，从完全随机到理解其中的一些文本，你知道的，整理胡萝卜蛋糕食谱，同时也编写代码。



![](img/b46c7ab563229c69723d79f17ee24102_7.png)

好啦，所以这些预先训练的基于模型很棒，实际上有很多都是开源的，但你知道它是在网上的这些数据集上训练的，它可能有地理作业，你可能会在左边看到，它问印度的首都是什么，肯尼亚的首都是什么。

法国的首都到底是什么，你知道在没有看到答案的情况下，所以当你输入墨西哥的首都，LM可能会说匈牙利的首都是什么，正如你所看到的，它并不真正有用。



![](img/b46c7ab563229c69723d79f17ee24102_9.png)

从聊天机器人界面的意义上，那么如何将其发送到聊天机器人界面，嗯，微调是让你到达那里的方法之一，它应该是你工具箱里的一个工具，所以预训练是让你得到基本模型的第一步，当您在，实际上没有那么多数据，嗯。

您可以使用微调来获得微调的模型，实际上即使是一个微调的模型，之后可以继续添加微调步骤，所以微调真的是之后的一步，您可以使用相同类型的数据，实际上，您可以从不同的来源刮取数据，并将其整理在一起。

你很快就会看到的，所以这可以是这句话，未引用未标记数据，但您也可以自己管理数据，使它更结构化，以便模型了解，我认为微调和预训练的区别在于，所需的数据要少得多，你是建立在这个基础模型上的。

已经学会了这么多知识和基本的语言技能，你真的把它提升到了一个新的水平，你不需要那么多数据，所以这真的是你工具箱里的一个工具，如果你来自其他机器学习领域，你知道这是对区分任务的微调，也许你在处理图像。

你一直在微调图片，你会发现这里对微调的定义有点松散，对于生成性任务来说，它没有很好的定义，因为我们实际上是在更新整个模型的权重，不仅仅是一部分，对于微调来说，其他类型的模型。

所以我们在这里的训练目标和预训练是一样的，用于微调，下一个令牌生产，我们所做的就是改变数据，所以它在某种程度上更有条理，模型在输出和模仿这种结构时可以更加一致。

还有更先进的方法来减少你想更新这个模型的程度，我们稍后再讨论这个。

![](img/b46c7ab563229c69723d79f17ee24102_11.png)

那么微调到底为你做了什么，所以你现在就知道是什么了，但是有哪些不同的任务呢，所以你实际上可以很好地处理它，我喜欢思考的一个大类别是行为改变，你在改变模型的行为，你说得很对，你知道在这个聊天界面里。

我们现在在聊天，我们不是在调查，因此，这导致模型能够更一致地做出反应，这意味着模型可以更好地聚焦，也许这对适度更好，例如，它通常也只是在梳理它的能力，所以在这里它更擅长交谈。

所以它现在可以谈论各种各样的事情，与之前相比，我们必须做大量的快速工程，为了梳理出这些信息，微调还能帮助模型获得新知识，所以这可能是围绕着特定的主题，而这些主题不在这个基础上，预训练模型。

这可能意味着纠正旧的不正确信息，所以也许你知道，您希望模型实际注入的更多最新信息，当然，更常见的是，你用这些模型同时做，所以你经常改变行为，你想让它获得新的知识，所以把它降低一个等级。



![](img/b46c7ab563229c69723d79f17ee24102_13.png)

所以微调的任务，只是给llms发短信而已，我喜欢把它分为两个不同的类别，所以你可以考虑一下，一个作为提取文本，所以你把文本放进去，你得到的短信更少，所以很多工作都在阅读，这可能是提取关键字。

您可能正在路由的主题，你知道的，根据你看到的所有数据，你路由聊天，例如，这里有一些API或其他不同的代理，就像不同的代理能力，这与膨胀形成鲜明对比，所以这就是你把文本放进去的地方，你会得到更多的短信。

所以我喜欢把它看作是写作，所以这可能是聊天，写电子邮件，编写代码，真正理解你的任务，这两个不同任务之间的区别，或者您有多个任务需要微调，是我发现的最明显的成功标志，所以如果你想成功。

我对模型的微调越来越清楚你想做什么任务，清晰真的意味着知道什么是，你知道一个好的，你知道好的输出是什么样子的。



![](img/b46c7ab563229c69723d79f17ee24102_15.png)

输出是什么样子的，但更好的产出是什么样子的，因此，当您知道某些东西在编写代码方面做得更好时，或者在路由方面做得更好。



![](img/b46c7ab563229c69723d79f17ee24102_17.png)

这项任务确实能帮助你微调这个模型，使它做得很好，好啦，所以如果这是你第一次微调，我推荐几个不同的步骤，因此，首先通过提示设计一个大型LLM来确定一个任务，那可能是查奇BT，例如。

所以你只是在玩chgbt，像平时一样，你找到一些，你知道它正在做的任务，好啦，是啊，是啊，所以不是很好，但也不可怕，所以你知道在可能的范围内，但它不是，它不是最好的，你希望它为你的任务做得更好。

所以选一个任务选一个然后选第四个，嗯，获取该任务的一些输入和输出，所以你发了一些短信，你发了一些短信，输入输入文本输出文本，为了完成这项任务，我喜欢用的一个黄金数字是一千，因为我发现这是一个很好的起点。

你需要大量的数据。

![](img/b46c7ab563229c69723d79f17ee24102_19.png)

并确保这些输入和输出比OK更好。

![](img/b46c7ab563229c69723d79f17ee24102_21.png)

LLM的结果，在你不能一直产生这些输入输出之前，所以要确保你有这些数据对，你也会在实验室里探索这个，整个管道，从那个开始，然后你要做的就是，然后，您可以对这些数据微调一个小LLM。

只是为了感受一下性能的提升，所以只有当你第一次，这是我推荐的，所以现在让我们跳进实验室，在那里你可以探索用于预训练的数据集，微调与微调，所以你很清楚这些输入输出对是什么样子的。



![](img/b46c7ab563229c69723d79f17ee24102_23.png)

好啦，因此，我们将从导入几个不同的库开始，所以我们要运行它，我们要使用的第一个库是数据集，图书馆从拥抱脸，他们有一个很棒的功能，叫做负载数据集，在那里，你可以从他们的集线器上提取一个数据集。

并能够运行它。

![](img/b46c7ab563229c69723d79f17ee24102_25.png)

所以在这里我要提取训练前的数据集，叫做堆，你只是看到了更多，而在这里，我抓住了分裂，即训练与测试，我实际上在抓流媒体，等于真，因为这个数据集很大，如果不弄坏这个笔记本，我们就不能下载它。

所以我要一次一个地播放，这样我们就可以探索里面不同的数据，所以只要把它装起来。

![](img/b46c7ab563229c69723d79f17ee24102_27.png)

现在我要看看前五个，所以这只是使用迭代工具。

![](img/b46c7ab563229c69723d79f17ee24102_29.png)

很好好的，所以你可以在预先训练的数据集中看到，这里有很多数据看起来像是刮的，所以你知道这篇文章说它已经完成并提交了，你可以在Android上玩TCS的生存，这是一个例子，让我们看看能不能找到另一个。

这里还有一个，所以这只是被刮掉的代码，被刮除的XML代码，这是另一个数据点，这里，您将看到文章内容，你会看到这个主题，你知道的，亚马逊宣布在AWS上提供新服务，然后这里是关于你知道的，大满贯钓鱼包机。

所以这是一个家族企业，所以这就是，你知道，只是不同数据集的大杂烩，基本上是从互联网上刮下来的，我想把它和微调数据集进行对比，你将在不同的实验室使用，我们要抢一家公司，问答对数据集。

你知道从常见问题解答中刮下来的，并整理了内部工程文件，它叫拉米尼医生，是关于公司的，拉米尼，嗯，所以我们将阅读JSON文件，去看看里面有什么，好啦，所以这是更结构化的数据，对吧，所以这里有问答对。

这是关于这家公司的非常具体的。

![](img/b46c7ab563229c69723d79f17ee24102_31.png)

所以使用这个数据集的最简单方法是连接。

![](img/b46c7ab563229c69723d79f17ee24102_33.png)

其实这些问题和答案一起，把它送进模型里，这就是我要做的，我要把它变成一个迪克，然后我要看看把其中一个连接在一起是什么样子的。



![](img/b46c7ab563229c69723d79f17ee24102_35.png)

把问题串联起来。

![](img/b46c7ab563229c69723d79f17ee24102_37.png)

在这里给出答案，当然，你可以用任何可能的方式准备你的数据。

![](img/b46c7ab563229c69723d79f17ee24102_39.png)

我只想说出几种不同的常见方法，对你的数据进行格式化和结构化，问答配对，但也有指令和响应对。

![](img/b46c7ab563229c69723d79f17ee24102_41.png)

输入输出对，只是在这里很普通，你也可以拥有它，反正我们是连在一起的，这只是你在上面看到的文字，好啦，所以把它连接起来，你知道这很简单，但有时这就足以看到结果，有时不是，嗯，因此。

您仍然会发现模型可能需要更多的结构来帮助它。

![](img/b46c7ab563229c69723d79f17ee24102_43.png)

这与快速工程非常相似，其实呢，所以更进一步，您还可以使用以下指令处理数据，在这种情况下，问答提示模板，这里有一个常见的模板注释。



![](img/b46c7ab563229c69723d79f17ee24102_45.png)

在问题之前有一磅一磅，一种标记，这样就可以很容易地用作结构。

![](img/b46c7ab563229c69723d79f17ee24102_47.png)

告诉模特期待接下来会发生什么，它在看到问题后期待一个问题，它还可以帮助您发布处理模型的输出。

![](img/b46c7ab563229c69723d79f17ee24102_49.png)

即使经过微调，所以我们有那个，因此，让我们来看看这个提示符模板的运行情况。

![](img/b46c7ab563229c69723d79f17ee24102_51.png)

看看这与串联的问答有什么不同。

![](img/b46c7ab563229c69723d79f17ee24102_53.png)

所以在这里你可以看到，提示模板就是这样，问题和答案在那里干净利落地完成了。

![](img/b46c7ab563229c69723d79f17ee24102_55.png)

通常，将输入和输出分开是有帮助的，所以我要把答案去掉把它们分开，因为这所房子只是很容易地使用数据集进行评估，因为你知道，当您将数据集拆分为训练和测试时，所以现在我要做的是把所有这些。



![](img/b46c7ab563229c69723d79f17ee24102_57.png)

你知道的，将所有此模板应用于整个数据集。

![](img/b46c7ab563229c69723d79f17ee24102_59.png)

所以只要在上面运行一个for循环，只是及时补水，所以这只是，你知道的，用f字符串或格式将该问题和答案添加到其中。



![](img/b46c7ab563229c69723d79f17ee24102_61.png)

这里有蟒蛇的东西好吧，所以让我们来看看这篇文章之间的区别。

![](img/b46c7ab563229c69723d79f17ee24102_63.png)

唯一一件事，和问答形式。

![](img/b46c7ab563229c69723d79f17ee24102_65.png)

酷，所以只有文本，你在这里输入的都是串联的，这是一个问题的答案，更有条理，你可以用任何一个，但当然，我确实建议对它进行结构化，以帮助评估。



![](img/b46c7ab563229c69723d79f17ee24102_67.png)

基本上就是这样，存储这些数据的最常见方式通常是在json行文件中。

![](img/b46c7ab563229c69723d79f17ee24102_69.png)

所以JSON L文件，Json l，基本上就是，您知道每一行都是一个json对象。

![](img/b46c7ab563229c69723d79f17ee24102_71.png)

就这样了，所以只是把它写在那里归档，你也可以在拥抱脸上上传这个数据集，如下所示。

![](img/b46c7ab563229c69723d79f17ee24102_73.png)

因为你以后也可以用这个。

![](img/b46c7ab563229c69723d79f17ee24102_75.png)

接下来你可以像这样把它从云中拉出来，你将深入研究一种特殊的微调变体，称为指令。

![](img/b46c7ab563229c69723d79f17ee24102_77.png)