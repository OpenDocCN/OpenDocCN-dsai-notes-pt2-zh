# LangChain_微调ChatGPT提示词_RAG模型应用_agent_生成式AI - P28：4——链 - 吴恩达大模型 - BV1gLeueWE5N

![](img/6979b54d544ad51cba7b8167af30399e_0.png)

在这堂课中。

![](img/6979b54d544ad51cba7b8167af30399e_2.png)

哈里森将教授土地链最重要的关键构建块，即链，链通常结合了一个lm大型语言模型和一个提示，以及这个构建块，你也可以将这些构建块放在一起，来完成对你文本或其他数据的一系列操作，我对此充满期待。

让我们立即开始吧。

![](img/6979b54d544ad51cba7b8167af30399e_4.png)

我们将像以前那样加载环境变量，然后，我们还将加载我们将要使用的一些数据。

![](img/6979b54d544ad51cba7b8167af30399e_6.png)

嗯，这些链条的一部分力量在于，你可以同时运行它们过许多输入。

![](img/6979b54d544ad51cba7b8167af30399e_8.png)

在这里。

![](img/6979b54d544ad51cba7b8167af30399e_10.png)

我们将加载一个pandas数据框，pandas数据框只是一个包含大量不同数据元素的数据结构。

![](img/6979b54d544ad51cba7b8167af30399e_12.png)

如果你不熟悉pandas，不要害怕，主要的。

![](img/6979b54d544ad51cba7b8167af30399e_14.png)

主要的观点在这里是我们正在加载一些我们可以后来使用的数据，因此，如果我们看进去这个pandas数据框。



![](img/6979b54d544ad51cba7b8167af30399e_16.png)

我们可以看到有一个产品列，然后有一个评论列，而且这些行中的每一行都是一个我们可以开始通过链传递的不同数据点。



![](img/6979b54d544ad51cba7b8167af30399e_18.png)

所以第一个我们要覆盖的链是lom链。

![](img/6979b54d544ad51cba7b8167af30399e_20.png)

而且这是一个简单但真的很强大的链，它支撑了许多未来将要覆盖的链。

![](img/6979b54d544ad51cba7b8167af30399e_22.png)

所以我们要导入三样不同的东西。

![](img/6979b54d544ad51cba7b8167af30399e_24.png)

我们将导入openai模型，所以我们将导入聊天提示模板，所以这就是提示，然后我们将导入llm链，所以首先我们要做的第一件事是，我们将初始化我们要使用的语言模型。



![](img/6979b54d544ad51cba7b8167af30399e_26.png)

所以我们将初始化chat open ai，使用高温度。

![](img/6979b54d544ad51cba7b8167af30399e_28.png)

以便我们可以得到一些有趣的描述，现在我们将初始化一个提示。

![](img/6979b54d544ad51cba7b8167af30399e_30.png)

这个提示将接受一个名为产品的变量，它将要求llm生成什么。

![](img/6979b54d544ad51cba7b8167af30399e_32.png)

描述生产该产品的最佳名称是什么，最后，我们将将这些两件事结合起来形成一个链，因此，这就是我们所说的llm链，它相当简单，它就是llm和提示的组合。



![](img/6979b54d544ad51cba7b8167af30399e_34.png)

但现在这条链将让我们能够通过提示进入llm。

![](img/6979b54d544ad51cba7b8167af30399e_36.png)

以序列化的方式，因此，如果我们有一个产品叫做皇后尺寸床单套装。

![](img/6979b54d544ad51cba7b8167af30399e_38.png)

我们可以通过使用chain run将这个通过链，而这将会做的就是它将提示在底层格式化。

![](img/6979b54d544ad51cba7b8167af30399e_40.png)

然后它将整个提示传递给llm，因此，我们可以看到，我们得到了这个假设公司的名称。

![](img/6979b54d544ad51cba7b8167af30399e_42.png)

称为皇家床品，所以这里是一个暂停的好时机，你可以输入你想要的任何产品描述，你可以看到链将输出什么结果。



![](img/6979b54d544ad51cba7b8167af30399e_44.png)

所以LLM链是最基本的链类型。

![](img/6979b54d544ad51cba7b8167af30399e_46.png)

而且这将在未来被广泛使用，所以我们可以看到这将如何在下一种类型的链中使用。

![](img/6979b54d544ad51cba7b8167af30399e_48.png)

这将是序列链，所以序列链将运行一系列链一个接一个。

![](img/6979b54d544ad51cba7b8167af30399e_50.png)

所以首先你将导入简单的序列链。

![](img/6979b54d544ad51cba7b8167af30399e_52.png)

这工作得很好，当我们有只期望一个输入并返回一个输出的子链时。

![](img/6979b54d544ad51cba7b8167af30399e_54.png)

所以这里我们将首先创建一个链。

![](img/6979b54d544ad51cba7b8167af30399e_56.png)

该链使用LLM和一个提示，这个提示将接受产品。

![](img/6979b54d544ad51cba7b8167af30399e_58.png)

并将返回描述该公司的最佳名称，这将是第一个链。

![](img/6979b54d544ad51cba7b8167af30399e_60.png)

然后我们将在第二个链中创建第二个链，我们将输入公司名称，然后输出该公司的二十字描述。

![](img/6979b54d544ad51cba7b8167af30399e_62.png)

所以你可以想象这些链如何想要一个接一个运行。

![](img/6979b54d544ad51cba7b8167af30399e_64.png)

其中第一个链的输出，公司名称将被传递给第二个链。

![](img/6979b54d544ad51cba7b8167af30399e_66.png)

我们可以很容易地这样做，通过创建一个简单的序列链。

![](img/6979b54d544ad51cba7b8167af30399e_68.png)

其中我们有那里描述的两个链，我们将称这个整体为简单链，现在，你可以运行这个链过任何产品描述。

![](img/6979b54d544ad51cba7b8167af30399e_70.png)

所以如果我们用它与上面的女王尺寸床套。

![](img/6979b54d544ad51cba7b8167af30399e_72.png)

我们可以运行它，我们可以看到它首先输出皇家床品。

![](img/6979b54d544ad51cba7b8167af30399e_74.png)

然后它将将其传递给第二个链，它产生了关于该公司可能关于的描述，简单序列链在只有一个输入和一个输出时工作得很好。



![](img/6979b54d544ad51cba7b8167af30399e_76.png)

但是，当有多个输入或输出时怎么办，所以我们可以通过使用普通的序列链来做到这一点。

![](img/6979b54d544ad51cba7b8167af30399e_78.png)

让我们导入它，然后你将创建一系列我们将使用的链。

![](img/6979b54d544ad51cba7b8167af30399e_80.png)

一个接一个，我们将使用上面的数据，其中包含评论，我们首先将取第一个链。

![](img/6979b54d544ad51cba7b8167af30399e_82.png)

嗯，评论并翻译成英语。

![](img/6979b54d544ad51cba7b8167af30399e_84.png)

与第二个链，我们将创建该评论的总结为一句话。

![](img/6979b54d544ad51cba7b8167af30399e_86.png)

这将使用之前生成的英语评论。

![](img/6979b54d544ad51cba7b8167af30399e_88.png)

第三个链将检测评论最初使用的语言。

![](img/6979b54d544ad51cba7b8167af30399e_90.png)

所以如果你注意到这在使用来自原始评论的review变量。

![](img/6979b54d544ad51cba7b8167af30399e_92.png)

最后，第四个链将接受多个输入。

![](img/6979b54d544ad51cba7b8167af30399e_94.png)

所以这将接受总结变量，我们在第二个链中计算的，和语言变量，我们在第三个链中计算的，它将要求对总结的回应以指定的语言。



![](img/6979b54d544ad51cba7b8167af30399e_96.png)

请注意，所有这些子链都有一个重要的事情，即，那是否输入键和输出键需要精确到细节，所以这里我们在进行审查，这是一个将在开始时传递的变量。



![](img/6979b54d544ad51cba7b8167af30399e_98.png)

我们可以看到，我们明确设置了输出键为英语评论。

![](img/6979b54d544ad51cba7b8167af30399e_100.png)

然后，它在下面的提示中被使用，在那里，我们以相同的变量名称输入英语评论，并将该链的输出键设置为摘要。

![](img/6979b54d544ad51cba7b8167af30399e_102.png)

我们可以看到，它在最终链中被使用，第三个提示输入原始变量和输出语言，再次在最终提示中被使用。

![](img/6979b54d544ad51cba7b8167af30399e_104.png)

准确地对齐这些变量名称非常重要。

![](img/6979b54d544ad51cba7b8167af30399e_106.png)

因为有许多不同输入和输出在进行，如果你有任何键错误，你应该肯定检查它们是否对齐。

![](img/6979b54d544ad51cba7b8167af30399e_108.png)

所以，简单的序列链可以输入多个链。

![](img/6979b54d544ad51cba7b8167af30399e_110.png)

其中每个链都有一个输入和一个输出，以看到这种表示的视觉化，我们可以看到这张幻灯片，其中一个链输入另一个链。



![](img/6979b54d544ad51cba7b8167af30399e_112.png)

在这里，我们可以看到序列链的视觉描述。

![](img/6979b54d544ad51cba7b8167af30399e_114.png)

与上述链相比，您会发现链中的每一步都可以输入多个输入变量。

![](img/6979b54d544ad51cba7b8167af30399e_116.png)

这是有用的，当你有更复杂的下游链需要由多个先前的链组成时。

![](img/6979b54d544ad51cba7b8167af30399e_118.png)

现在我们有了所有这些链，我们可以轻松地将它们组合在序列链中。

![](img/6979b54d544ad51cba7b8167af30399e_120.png)

所以你会发现这里，我们将我们创建的四个链传递给链，变量将创建输入变量，其中包含一个人类输入。

![](img/6979b54d544ad51cba7b8167af30399e_122.png)

这是评论，然后我们想要返回所有中间输出。

![](img/6979b54d544ad51cba7b8167af30399e_124.png)

所以，英语评论，摘要，然后是后续消息，现在我们可以运行一些数据。

![](img/6979b54d544ad51cba7b8167af30399e_126.png)

所以让我们选择一条评论并通过整体链传递它。

![](img/6979b54d544ad51cba7b8167af30399e_128.png)

我们可以看到，原始评论看起来像是法语。

![](img/6979b54d544ad51cba7b8167af30399e_130.png)

我们可以看到英语评论作为翻译，我们可以看到该评论的摘要，然后，我们可以看到后续消息在原始语言的法语中，您应该在这里暂停视频并尝试输入不同的结果，我们已经覆盖了llm链和序列链。

但如果你想要做更复杂的事情，一个常见的但基本的操作是将输入路由到一个链，取决于输入的确切类型，这是一个很好的想象方式。



![](img/6979b54d544ad51cba7b8167af30399e_132.png)

这是你如果有多个子链的情况，每个子链都专门用于处理一种类型的输入，你可能有一个路由器链。

![](img/6979b54d544ad51cba7b8167af30399e_134.png)

它首先决定将输入传递给哪个子链，然后，将输入传递给该链。

![](img/6979b54d544ad51cba7b8167af30399e_136.png)

以具体例子来说，让我们看看我们是如何在不同类型的链之间路由的，取决于似乎到来的主题。

![](img/6979b54d544ad51cba7b8167af30399e_138.png)

所以，我们有这里不同的提示，根据主题的类型，一个提示对于回答物理问题很有用，第二个提示对于回答数学问题很有用，第三个对于历史，然后第四个对于计算机科学，让我们定义所有这些提示模板。



![](img/6979b54d544ad51cba7b8167af30399e_140.png)

当我们有了这些提示模板。

![](img/6979b54d544ad51cba7b8167af30399e_142.png)

然后我们可以提供更多关于它们的信息，我们可以为每个一个命名。

![](img/6979b54d544ad51cba7b8167af30399e_144.png)

然后描述，这是对物理的描述，一个是用于回答物理问题的。

![](img/6979b54d544ad51cba7b8167af30399e_146.png)

这信息将被传递给路由器链。

![](img/6979b54d544ad51cba7b8167af30399e_148.png)

所以路由器链可以决定何时使用此子链。

![](img/6979b54d544ad51cba7b8167af30399e_150.png)

现在让我们导入这里需要的其他类型的链。

![](img/6979b54d544ad51cba7b8167af30399e_152.png)

我们需要一个多提示链，这是一种特定类型的链，用于在多个不同提示模板之间路由。

![](img/6979b54d544ad51cba7b8167af30399e_154.png)

正如你看到的所有选项都是提示模板本身。

![](img/6979b54d544ad51cba7b8167af30399e_156.png)

但这只是您可以路由之间的一种东西，您可以路由任何类型的链。

![](img/6979b54d544ad51cba7b8167af30399e_158.png)

我们在这里实现的其他类是llm路由器链，这使用语言模型本身在子链之间路由。

![](img/6979b54d544ad51cba7b8167af30399e_160.png)

这是上面描述和名称将被使用的地方。

![](img/6979b54d544ad51cba7b8167af30399e_162.png)

我们还导入了一个路由器输出解析器，这解析输出为可以下游游用于确定应使用哪个链的字典。

![](img/6979b54d544ad51cba7b8167af30399e_164.png)

以及该链的输入应是什么，现在可以开始使用它了，让我们导入并定义我们将使用的语言模型。

![](img/6979b54d544ad51cba7b8167af30399e_166.png)

我们现在创建目的地链，这些是路由器链将调用的链。

![](img/6979b54d544ad51cba7b8167af30399e_168.png)

正如你看到的，每个目的地链本身都是一个语言模型链。

![](img/6979b54d544ad51cba7b8167af30399e_170.png)

一个llm链，除了目的地链。

![](img/6979b54d544ad51cba7b8167af30399e_172.png)

我们还需要一个默认训练，这是当路由器无法决定应使用哪个子链时将被调用的链，例如，上面的例子可能在输入问题与物理无关时被调用，如数学、历史或计算机科学。



![](img/6979b54d544ad51cba7b8167af30399e_174.png)

现在，我们定义llm用于在不同链之间路由的模板，这包含要完成的任务的指示，以及输出应遵循的特定格式，让我们将这些部分放在一起来构建路由器链。



![](img/6979b54d544ad51cba7b8167af30399e_176.png)

首先，我们创建完整的路由器模板，通过格式化它来使用我们上面定义的目的地，这个模板灵活于许多不同类型的目的地。



![](img/6979b54d544ad51cba7b8167af30399e_178.png)

你可以在这里暂停并添加不同类型的目的地。

![](img/6979b54d544ad51cba7b8167af30399e_180.png)

在这里，而不是只是物理。

![](img/6979b54d544ad51cba7b8167af30399e_182.png)

数学、历史和计算机科学，你可以在这里暂停并添加不同类型的目的地。

![](img/6979b54d544ad51cba7b8167af30399e_184.png)

所以，在这里，而不是只是物理，数学、历史和计算机科学，你可以添加一个不同的主题，如英语或拉丁语，接下来，我们从这个模板中创建提示模板，然后，我们通过传递llm创建路由链。



![](img/6979b54d544ad51cba7b8167af30399e_186.png)

并总体路由提示说明，在这里我们有路由输出解析器，这很重要，因为它将帮助这条链决定将某些链路由到何处，最后，将所有部分放在一起，我们可以创建总体链，这有一个定义在这里的路由器链。

它包含我们要在这里传递的目的地链，我们还在这里传递默认链，我们现在可以使用这条链。

![](img/6979b54d544ad51cba7b8167af30399e_188.png)

所以让我们问你一些问题，如果我们问它关于物理的问题。

![](img/6979b54d544ad51cba7b8167af30399e_190.png)

我们应该希望看到它被路由到包含输入的物理链上。

![](img/6979b54d544ad51cba7b8167af30399e_192.png)

什么是黑体辐射，然后，它将被传递到下面的链中。

![](img/6979b54d544ad51cba7b8167af30399e_194.png)

我们可以看到响应非常详细，充满了许多物理细节，你应该在这里暂停视频并尝试输入不同的内容，你可以尝试使用我们上面定义的所有其他特殊链类型，例如，如果我们问它一个数学问题。



![](img/6979b54d544ad51cba7b8167af30399e_196.png)

我们应该看到它被路由到数学链，然后传递到那里。

![](img/6979b54d544ad51cba7b8167af30399e_198.png)

我们也可以看到当我们输入问题时会发生什么。

![](img/6979b54d544ad51cba7b8167af30399e_200.png)

这与任何子链都不相关，在这里我们问它一个生物学问题。

![](img/6979b54d544ad51cba7b8167af30399e_202.png)

我们可以看到它选择的链是None，这意味着它将被传递到默认链，默认链本身只是一个对语言模型的通用调用，幸运的是，语言模型对生物学知道很多，所以现在我们已经覆盖了这些基本的构建块，我们可以帮助它。

类型的链，我们可以开始将它们组合起来创建非常有趣的应用程序，例如，在下一节中。