# (超爽中英!) 2024公认最全的【吴恩达大模型LLM】系列教程！附代码_LangChain_微调ChatGPT提示词_RAG模型应用_agent_生成式AI - P93：2.L1-keyword search.zh - 吴恩达大模型 - BV1gLeueWE5N

欢迎第一课，学习关键词搜索回答问题。

![](img/988afc7b28b046626b485b8bba457d41_1.png)

数据库搜索是导航世界关键，包括搜索引擎，也包括应用内搜索，如搜索Spotify、YouTube或谷歌地图。



![](img/988afc7b28b046626b485b8bba457d41_3.png)

例如，公司组织需用关键词搜索或搜索内部文档，关键词搜索是构建搜索系统常用方法，看如何使用关键词搜索系统，看语言模型如何改进系统，现在看这个代码示例，连接数据库，做关键词搜索。

首单元格安装uviate客户端。

![](img/988afc7b28b046626b485b8bba457d41_5.png)

无需运行此操作，若在教室中运行，但若要下载此代码并在自己的环境中运行。

![](img/988afc7b28b046626b485b8bba457d41_7.png)

需安装viviate客户端，需运行的首代码单元，加载稍后课程中所需的API密钥。

![](img/988afc7b28b046626b485b8bba457d41_9.png)

现在我们可以导入v八，这将允许我们连接在线数据库，我们将讨论这个数据库，谈谈viviate是什么，Uv八是一个开源数据库，具有关键词搜索功能，还有向量搜索功能，依赖于语言模型。

我们将使用的API密钥是公开的，这是公共演示的一部分，实际密钥并非秘密，你可以使用它，我们鼓励你用它访问演示数据库。



![](img/988afc7b28b046626b485b8bba457d41_11.png)

现在配置了认证设置，让我们看看连接客户端和实际数据库的代码。

![](img/988afc7b28b046626b485b8bba457d41_13.png)

这个数据库是公共的，包含1000万条记录，这些是维基百科的记录，每条记录或行是一个段落，是维基百科中的一段，这1000万记录来自10种语言。



![](img/988afc7b28b046626b485b8bba457d41_15.png)

其中100万是英语，其余900万是其他语言，我们可以，选择和过滤要查询的语言。

![](img/988afc7b28b046626b485b8bba457d41_17.png)

稍后在本实验中查看。

![](img/988afc7b28b046626b485b8bba457d41_19.png)

运行此行代码后，确保客户端已准备就绪并连接，如果得到true，则表示本地uv eight客户端能够连接到远程uate数据库。



![](img/988afc7b28b046626b485b8bba457d41_21.png)

现在我们可以对数据集进行关键词搜索，在查看代码之前，让我们简单谈谈关键词搜索，假设你有查询，草是什么颜色，你正在搜索一个非常小的档案，其中包含这五个文本，这五句话，明天是星期六，草是绿色的。

加拿大的首都是渥太华，天空是蓝色的，鲸鱼是哺乳动物，这是一个简单的搜索示例，关键词搜索的工作原理是高层次地比较。



![](img/988afc7b28b046626b485b8bba457d41_23.png)

因此，如果我们比较查询和第一句话共有多少个单词，它们只共享单词是。

![](img/988afc7b28b046626b485b8bba457d41_25.png)

因此，它们共有1个单词，我们可以看到档案中每个句子的计数。

![](img/988afc7b28b046626b485b8bba457d41_27.png)

我们可以看到第二句话，与查询共有最多的单词，因此，关键词搜索可能会检索该答案。

![](img/988afc7b28b046626b485b8bba457d41_29.png)

现在我们已经连接到数据库，让我们构建将查询它的函数。

![](img/988afc7b28b046626b485b8bba457d41_31.png)

让我们称之为关键词搜索。

![](img/988afc7b28b046626b485b8bba457d41_33.png)

我们将构建这个并来回切换，这里我们需要做的最简单的事情是说出响应等于，然后客户端点查询点，获取现在，我们在这里所做的一切，这就是我们所看到的。



![](img/988afc7b28b046626b485b8bba457d41_35.png)

因此，所有这些都由uv八api定义，它告诉我们数据的类型，我认为我们需要在这里添加的集合称为文章。

![](img/988afc7b28b046626b485b8bba457d41_37.png)

这在数据库中定义，由于我们想进行关键词搜索，嗯，在我们进入关键词搜索之前，让我们复制这些属性的样子，这些将是，这是一个由这个数据集定义的列表，看起来像这样，数据库中的每篇文章都有多个属性。

我们在这里所说的是，对于这个搜索的结果，我们希望您返回给我们，标题。

![](img/988afc7b28b046626b485b8bba457d41_39.png)

URL和每个结果的文本，这里还有其他属性。

![](img/988afc7b28b046626b485b8bba457d41_41.png)

但我们不希望数据库将它们返回给我们，现在现在进行关键词搜索部分V，V，8号有BM25和BM25类型。

![](img/988afc7b28b046626b485b8bba457d41_43.png)

这是关键词搜索还是词法搜索算法？并基于特定公式，对档案中的文档与查询评分，考察查询与每篇文档共享单词的计数，我们需要做的是说，查询等于将传递给您的查询，我们需要添加到此函数的查询，因此它也是此处的参数。

需要传递给we are with where的更多行，这里我们可以添加一个where子句，以特定方式格式化。



![](img/988afc7b28b046626b485b8bba457d41_45.png)

我们想要做的是限制结果仅限英语。

![](img/988afc7b28b046626b485b8bba457d41_47.png)

结果俚语将是一些，我们还将添加到这个定义中，比如说，默认情况下，我们将按英语语言过滤，仅查看英语文章。



![](img/988afc7b28b046626b485b8bba457d41_49.png)

![](img/988afc7b28b046626b485b8bba457d41_50.png)

这就是为什么我们在这里将其添加为默认值的原因，但这是我们可以随时在调用关键词搜索方法时更改的内容。

![](img/988afc7b28b046626b485b8bba457d41_52.png)

现在我们需要添加的另一行是说明使用limit，搜索引擎要返回多少结果，我们说，嗯，结果，在这里也定义，嗯，结果。



![](img/988afc7b28b046626b485b8bba457d41_54.png)

默认设为3，查询完成，我们只说做，然后关闭请求。

![](img/988afc7b28b046626b485b8bba457d41_56.png)

完成后，现在可获取响应并返回结果。

![](img/988afc7b28b046626b485b8bba457d41_58.png)

这是我们的关键词搜索功能，现在，让我们使用这个关键词搜索功能并传递一个查询，假设我们说最受欢迎的电视事件是什么，我们将查询传递给函数，然后打印它。



![](img/988afc7b28b046626b485b8bba457d41_60.png)

所以让我们看看运行这个会发生什么，它去并返回。

![](img/988afc7b28b046626b485b8bba457d41_62.png)

这些是我们拥有的搜索结果，将会有很多文本需要浏览，但我们可以看到，这是字典列表，所以定义一个打印更好方式的函数。



![](img/988afc7b28b046626b485b8bba457d41_64.png)

函数可以像这样 print result，用这个可以说。

![](img/988afc7b28b046626b485b8bba457d41_66.png)

好的，现在打印并让我确切看到结果。

![](img/988afc7b28b046626b485b8bba457d41_68.png)

我们得到的第一结果是这是文本，这是文本的段落或文章。

![](img/988afc7b28b046626b485b8bba457d41_70.png)

这是标题，嗯，记得我们找的是最常播出的活动。

![](img/988afc7b28b046626b485b8bba457d41_72.png)

这看起来不太像正确结果。

![](img/988afc7b28b046626b485b8bba457d41_74.png)

![](img/988afc7b28b046626b485b8bba457d41_75.png)

但包含很多关键词，这里还有一篇关于超级碗的文章。

![](img/988afc7b28b046626b485b8bba457d41_77.png)

这是个更好的结果，所以超级碗可能是高收视率的活动。

![](img/988afc7b28b046626b485b8bba457d41_79.png)

这里还有另一个结果提到世界杯，但不是世界杯结果，对于每个结果，你会看到那篇文章的网址。

![](img/988afc7b28b046626b485b8bba457d41_81.png)

可以点击它，它会带我们到一个维基百科页面，可以尝试编辑查询，这样可以看到数据集中还有哪些内容，这是一个查询连接到数据库的高层示例，然后查看结果。



![](img/988afc7b28b046626b485b8bba457d41_83.png)

这里还可以尝试一些事情，你需要查看属性。

![](img/988afc7b28b046626b485b8bba457d41_85.png)

这是数据集构建时使用的属性列表，这些都是数据库中存储的列，可以说你可以查看维基百科页面收到的浏览量，你可以用它来过滤或排序，这是一个估计数字，但这是用于过滤的语言列，你可以使用其他语言值。

其他语言的代码看起来像这样。

![](img/988afc7b28b046626b485b8bba457d41_87.png)

英语，德语，法语，西班牙语，意大利语，日语，阿拉伯语。

![](img/988afc7b28b046626b485b8bba457d41_89.png)

中文，韩语和印地语，我相信，只需输入其中一个并传递给关键词搜索，它会给你那个语言的结果。

![](img/988afc7b28b046626b485b8bba457d41_91.png)

让我们看看如何用不同的语言查询数据库，所以假设我们复制这段代码，注意现在我们在这里打印结果，让我们指定语言为另一种语言，这里我将使用，比如说。



![](img/988afc7b28b046626b485b8bba457d41_93.png)

我们做了德语这里，因为有些单词可能是共享的，我们可以看到这里有一些结果，这个关于最常播出活动的结果是关于Busta Rhymes的音乐家，但你可以看到为什么它带来了这个结果，因为事件这个词在这里。

然后提到的专辑名称在这里是事件，所以提到的事件的结果是关于Busta Rhymes的音乐家，文本和查询共享，不必包含所有关键词，但至少有一些，BM25只需一个词相关，查询和文档共享的单词越多。

文档中重复的越多。

![](img/988afc7b28b046626b485b8bba457d41_95.png)

得分越高，总体来看，虽然返回了结果，这可能不是最佳答案，与问题最相关的文档。

![](img/988afc7b28b046626b485b8bba457d41_97.png)

看看语言模型如何帮助。

![](img/988afc7b28b046626b485b8bba457d41_99.png)

第一课结束时，回顾搜索的高层，主要组件是查询，搜索系统，系统可访问预处理文档档案，响应查询，系统按与查询最相关排序结果。



![](img/988afc7b28b046626b485b8bba457d41_101.png)

更仔细看，搜索系统可视为多阶段，第一阶段通常是检索或搜索，之后有重排阶段，重排常需包含额外信号，不仅仅是文本相关性，第一阶段，检索常用BM25算法评分文档，与查询相比，第一阶段检索实现含倒排索引概念。

注意此表与之前文档表不同，倒排索引是这种两列表，一列是关键词，旁边是含关键词的文档，这是为优化搜索速度，在搜索引擎中输入查询，期待几毫秒内结果，实践中就是这样，除了文档ID，关键词出现频率也添加到此。

现在对关键词搜索有良好概览，注意这个查询，天空什么颜色，查看倒排索引，颜色词含文档804，天空词也含文档804，804将从第一阶段检索结果中高评分，从关键词搜索理解，可看到一些限制。

假设我们有这个查询强烈头痛侧面。

![](img/988afc7b28b046626b485b8bba457d41_103.png)

如果搜索包含确切答案的文档档案，但使用不同关键词，所以不完全使用它们。

![](img/988afc7b28b046626b485b8bba457d41_105.png)

说剧烈偏头痛，关键词搜索无法检索此文档，语言模型可帮助此领域，因为它们不比较关键词，仅能查看总体含义。



![](img/988afc7b28b046626b485b8bba457d41_107.png)

能检索此类文档以响应此类查询，语言模型可改进搜索阶段，下节课将探讨如何实现，将探讨语言模型如何改进检索，或第一阶段使用嵌入，下节课主题，然后探讨重排如何工作及如何改进第二阶段，本课程结束时。

将探讨大型语言模型如何生成响应，基于先前的搜索步骤。

![](img/988afc7b28b046626b485b8bba457d41_109.png)