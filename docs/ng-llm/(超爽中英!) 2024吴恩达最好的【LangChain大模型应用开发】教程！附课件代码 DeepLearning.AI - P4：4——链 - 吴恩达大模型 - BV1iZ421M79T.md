# (超爽中英!) 2024吴恩达最好的【LangChain大模型应用开发】教程！附课件代码 DeepLearning.AI - P4：4——链 - 吴恩达大模型 - BV1iZ421M79T

![](img/33ec68ac66317c48322d0ad86cdb256f_0.png)

这节课，这节课。

![](img/33ec68ac66317c48322d0ad86cdb256f_2.png)

哈里森将教授土地链最重要的基础构建块，哈里森将教授土地链最重要的基础构建块，即链条，即链条，链条通常结合一个大语言模型和一个提示，链条通常结合一个大语言模型和一个提示，有了这个构建块，有了这个构建块。

你也可以将这些构建块组合在一起，你也可以将这些构建块组合在一起，执行文本或其他数据的序列操作，执行文本或其他数据的序列操作，我很兴奋深入探讨，现在开始，我很兴奋深入探讨，现在开始。



![](img/33ec68ac66317c48322d0ad86cdb256f_4.png)

我们将像以前一样加载环境变量，我们将像以前一样加载环境变量，我们还将加载一些稍后要使用的数据，我们还将加载一些稍后要使用的数据。



![](img/33ec68ac66317c48322d0ad86cdb256f_6.png)

嗯，嗯，这些链条的强大之处在于你可以同时运行它们，这些链条的强大之处在于你可以同时运行它们。

![](img/33ec68ac66317c48322d0ad86cdb256f_8.png)

在这里，在这里。

![](img/33ec68ac66317c48322d0ad86cdb256f_10.png)

我们将加载一个Pandas数据框，我们将加载一个Pandas数据框，Pandas数据框是一种数据结构，包含大量不同元素的数据，Pandas数据框是一种数据结构，包含大量不同元素的数据。



![](img/33ec68ac66317c48322d0ad86cdb256f_12.png)

如果你不熟悉Pandas，如果你不熟悉Pandas，不用担心，不用担心，主要，主要。

![](img/33ec68ac66317c48322d0ad86cdb256f_14.png)

主要观点是我们正在加载一些稍后可以使用的数据，主要观点是我们正在加载一些稍后可以使用的数据，所以如果我们查看这个Pandas数据框，所以如果我们查看这个Pandas数据框。



![](img/33ec68ac66317c48322d0ad86cdb256f_16.png)

我们可以看到有一个产品列，我们可以看到有一个产品列，然后有一个评论列，然后有一个评论列，每行都是我们可以开始通过链条的不同数据点，每行都是我们可以开始通过链条的不同数据点。



![](img/33ec68ac66317c48322d0ad86cdb256f_18.png)

我们要覆盖的第一个链条是lom链条，我们要覆盖的第一个链条是lom链条。

![](img/33ec68ac66317c48322d0ad86cdb256f_20.png)

这是一个简单但非常强大的链条，这是一个简单但非常强大的链条，它支撑着未来将讨论的许多链条，它支撑着未来将讨论的许多链条。



![](img/33ec68ac66317c48322d0ad86cdb256f_22.png)

我们将导入三个不同的东西，我们将导入三个不同的东西。

![](img/33ec68ac66317c48322d0ad86cdb256f_24.png)

我们将导入OpenAI模型，我们将导入OpenAI模型，所以我们将导入llm聊天提示模板，所以我们将导入llm聊天提示模板，这就是提示，这就是提示，然后我们将导入llm链条，然后我们将导入llm链条。

所以首先我们要做的是，所以首先我们要做的是，我们将初始化要使用的语言模型，我们将初始化要使用的语言模型。



![](img/33ec68ac66317c48322d0ad86cdb256f_26.png)

我们将初始化聊天OpenAI，带有高温度，我们将初始化聊天OpenAI，带有高温度。

![](img/33ec68ac66317c48322d0ad86cdb256f_28.png)

这样我们可以得到一些有趣的描述，这样我们可以得到一些有趣的描述，现在我们将初始化一个提示，现在我们将初始化一个提示。



![](img/33ec68ac66317c48322d0ad86cdb256f_30.png)

这个提示将接受一个名为产品的变量，这个提示将接受一个名为产品的变量，它将要求llm生成什么，它将要求llm生成什么。



![](img/33ec68ac66317c48322d0ad86cdb256f_32.png)

描述生产该产品的公司的最佳名称，描述生产该产品的公司的最佳名称，最后，我们将把这两个东西组合成一个链条，最后，我们将把这两个东西组合成一个链条，这就是我们所说的llm链条，这就是我们所说的llm链条。

它非常简单，它非常简单，它只是llm和提示的组合，它只是llm和提示的组合。

![](img/33ec68ac66317c48322d0ad86cdb256f_34.png)

但现在这个链条将允许我们按顺序通过提示和llm运行，但现在这个链条将允许我们按顺序通过提示和llm运行。



![](img/33ec68ac66317c48322d0ad86cdb256f_36.png)

以序列方式，以序列方式，所以如果我们有一个名为queen size sheet set的产品，所以如果我们有一个名为queen size sheet set的产品。



![](img/33ec68ac66317c48322d0ad86cdb256f_38.png)

我们可以通过使用chain run运行它，我们可以通过使用chain run运行它，这将内部格式化提示，这将内部格式化提示。



![](img/33ec68ac66317c48322d0ad86cdb256f_40.png)

然后将整个提示传递给llm，然后将整个提示传递给llm，因此，我们可以看到我们得到了这个假设公司的名称，因此，我们可以看到我们得到了这个假设公司的名称。



![](img/33ec68ac66317c48322d0ad86cdb256f_42.png)

称为皇家床品，称为皇家床品，现在暂停是个好时机，现在暂停是个好时机，可输入任何产品描述，可输入任何产品描述，可查看链输出结果，可查看链输出结果。



![](img/33ec68ac66317c48322d0ad86cdb256f_44.png)

LLM链是最基本类型，LLM链是最基本类型。

![](img/33ec68ac66317c48322d0ad86cdb256f_46.png)

未来将广泛使用，未来将广泛使用，可看到如何用于下一种链，可看到如何用于下一种链。

![](img/33ec68ac66317c48322d0ad86cdb256f_48.png)

即顺序链，即顺序链，顺序链依次运行一系列链，顺序链依次运行一系列链。

![](img/33ec68ac66317c48322d0ad86cdb256f_50.png)

首先导入简单顺序链，首先导入简单顺序链。

![](img/33ec68ac66317c48322d0ad86cdb256f_52.png)

这效果很好，这效果很好，当子链只期望一个输入和一个输出时，当子链只期望一个输入和一个输出时。

![](img/33ec68ac66317c48322d0ad86cdb256f_54.png)

因此，我们首先将创建一个链，因此，我们首先将创建一个链。

![](img/33ec68ac66317c48322d0ad86cdb256f_56.png)

它将使用一个llm和一个提示，它将使用一个llm和一个提示，这个提示将接受产品，这个提示将接受产品。

![](img/33ec68ac66317c48322d0ad86cdb256f_58.png)

并将返回描述该公司的最佳名称，并将返回描述该公司的最佳名称，所以这将是第一个链，所以这将是第一个链。

![](img/33ec68ac66317c48322d0ad86cdb256f_60.png)

然后，我们将在第二个链中创建第二个链，然后，我们将在第二个链中创建第二个链，我们将输入公司名称，然后输出该公司的20字描述，我们将输入公司名称，然后输出该公司的20字描述。



![](img/33ec68ac66317c48322d0ad86cdb256f_62.png)

因此，你可以想象这些链可能希望一个接一个地运行，因此，你可以想象这些链可能希望一个接一个地运行。

![](img/33ec68ac66317c48322d0ad86cdb256f_64.png)

第一链输出所在，第一链输出所在，公司名传入第二链，公司名传入第二链。

![](img/33ec68ac66317c48322d0ad86cdb256f_66.png)

创建简单序列链可轻易实现，创建简单序列链可轻易实现。

![](img/33ec68ac66317c48322d0ad86cdb256f_68.png)

描述的两个链在此，描述的两个链在此，整体称为简单链，整体称为简单链，现可运行此链于任何产品描述，现可运行此链于任何产品描述。



![](img/33ec68ac66317c48322d0ad86cdb256f_70.png)

若与上述皇后尺寸床单一起使用，若与上述皇后尺寸床单一起使用。

![](img/33ec68ac66317c48322d0ad86cdb256f_72.png)

可运行并查看首先输出皇家寝具，可运行并查看首先输出皇家寝具。

![](img/33ec68ac66317c48322d0ad86cdb256f_74.png)

然后传入第二链，然后传入第二链，得出该公司描述，得出该公司描述，简单序列链在单输入单输出时效果好，简单序列链在单输入单输出时效果好。



![](img/33ec68ac66317c48322d0ad86cdb256f_76.png)

但多输入或多输出时如何？但多输入或多输出时如何？仅用常规序列链即可做到，仅用常规序列链即可做到。

![](img/33ec68ac66317c48322d0ad86cdb256f_78.png)

导入它，导入它，然后创建将使用的多个链，然后创建将使用的多个链。

![](img/33ec68ac66317c48322d0ad86cdb256f_80.png)

一个接一个，一个接一个，将使用上面的评论数据，含评论，将使用上面的评论数据，含评论，首先将评论，首先将评论。



![](img/33ec68ac66317c48322d0ad86cdb256f_82.png)

嗯，嗯，翻译成英语，翻译成英语。

![](img/33ec68ac66317c48322d0ad86cdb256f_84.png)

用第二条链，用第二条链，将评论总结为一句话，将评论总结为一句话。

![](img/33ec68ac66317c48322d0ad86cdb256f_86.png)

将使用先前生成的英文评论，将使用先前生成的英文评论。

![](img/33ec68ac66317c48322d0ad86cdb256f_88.png)

第三条链将检测评论的原始语言，第三条链将检测评论的原始语言。

![](img/33ec68ac66317c48322d0ad86cdb256f_90.png)

因此，如果你注意到这是使用来自原始评论的review变量，因此，如果你注意到这是使用来自原始评论的review变量。



![](img/33ec68ac66317c48322d0ad86cdb256f_92.png)

最后，第四条链将接受多个输入，最后，第四条链将接受多个输入。

![](img/33ec68ac66317c48322d0ad86cdb256f_94.png)

这将接受我们使用第二条链计算的summary变量，这将接受我们使用第二条链计算的summary变量，以及我们使用第三条链计算的语言变量，以及我们使用第三条链计算的语言变量。

并将以指定语言请求对摘要的后续响应，并将以指定语言请求对摘要的后续响应。

![](img/33ec68ac66317c48322d0ad86cdb256f_96.png)

关于所有这些子链的一个重要事项，关于所有这些子链的一个重要事项，输入和输出键需要精确吗，输入和输出键需要精确吗，我们正在回顾，我们正在回顾，这是开始时传入的变量，这是开始时传入的变量。



![](img/33ec68ac66317c48322d0ad86cdb256f_98.png)

我们可以看到明确设置了输出键为英语评论，我们可以看到明确设置了输出键为英语评论。

![](img/33ec68ac66317c48322d0ad86cdb256f_100.png)

这在下面的下一个提示中被使用，这在下面的下一个提示中被使用，我们使用相同的变量名输入英语评论，我们使用相同的变量名输入英语评论。



![](img/33ec68ac66317c48322d0ad86cdb256f_102.png)

并将该链的输出键设置为摘要，并将该链的输出键设置为摘要。

![](img/33ec68ac66317c48322d0ad86cdb256f_104.png)

我们可以在最终链中看到它被使用，我们可以在最终链中看到它被使用，第三个提示输入原始变量和输出语言，第三个提示输入原始变量和输出语言，这再次在最终提示中被使用，这再次在最终提示中被使用。



![](img/33ec68ac66317c48322d0ad86cdb256f_106.png)

变量名对齐很重要，变量名对齐很重要。

![](img/33ec68ac66317c48322d0ad86cdb256f_108.png)

因输入输出很多，因输入输出很多，若有键错误，若有键错误，应检查对齐，应检查对齐。

![](img/33ec68ac66317c48322d0ad86cdb256f_110.png)

简单序列链接受多链，简单序列链接受多链。

![](img/33ec68ac66317c48322d0ad86cdb256f_112.png)

每链一输入一输出，每链一输入一输出，看图，一链入另一链，看图，一链入另一链。

![](img/33ec68ac66317c48322d0ad86cdb256f_114.png)

这里序列链视觉描述，这里序列链视觉描述。

![](img/33ec68ac66317c48322d0ad86cdb256f_116.png)

与上链比较，与上链比较，可见链中任一步可多输入，可见链中任一步可多输入。

![](img/33ec68ac66317c48322d0ad86cdb256f_118.png)

这很有用，这很有用，当你有更复杂的下游链需要组合多个先前链时，当你有更复杂的下游链需要组合多个先前链时。



![](img/33ec68ac66317c48322d0ad86cdb256f_120.png)

现在我们有所有这些链，现在我们有所有这些链，我们可以轻松地在顺序链中组合它们，我们可以轻松地在顺序链中组合它们。



![](img/33ec68ac66317c48322d0ad86cdb256f_122.png)

所以你会注意到，我们将创建的四个链传递给链，所以你会注意到，我们将创建的四个链传递给链，变量将创建包含一个人类输入的输入变量，变量将创建包含一个人类输入的输入变量。



![](img/33ec68ac66317c48322d0ad86cdb256f_124.png)

即评论，即评论，然后我们想要返回所有中间输出，然后我们想要返回所有中间输出。

![](img/33ec68ac66317c48322d0ad86cdb256f_126.png)

所以英语评论，摘要，所以英语评论，摘要，然后是后续消息，然后是后续消息。

![](img/33ec68ac66317c48322d0ad86cdb256f_128.png)

现在我们可以运行数据，现在我们可以运行数据。

![](img/33ec68ac66317c48322d0ad86cdb256f_130.png)

让我们选个评论，通过总链传递，让我们选个评论，通过总链传递。

![](img/33ec68ac66317c48322d0ad86cdb256f_132.png)

可见原始评论似乎是法语，可见原始评论似乎是法语，可见英文评论为翻译，可见英文评论为翻译，可见该评论的摘要，可见该评论的摘要，然后可见原始语言的法语后续消息，然后可见原始语言的法语后续消息。

你应该在这里暂停视频，尝试不同的输入，你应该在这里暂停视频，尝试不同的输入，我们涵盖了llm链和顺序链，我们涵盖了llm链和顺序链，但如果你想做更复杂的事，但如果你想做更复杂的事。

一个常见但基本操作是将输入路由到链，一个常见但基本操作是将输入路由到链。

![](img/33ec68ac66317c48322d0ad86cdb256f_134.png)

根据输入内容，想象一下，根据输入内容，想象一下，如果你有多个子链，如果你有多个子链，每个都针对特定类型输入，每个都针对特定类型输入。



![](img/33ec68ac66317c48322d0ad86cdb256f_136.png)

你可以有一个路由器链，你可以有一个路由器链，它首先决定将输入传递给哪个子链，它首先决定将输入传递给哪个子链。



![](img/33ec68ac66317c48322d0ad86cdb256f_138.png)

然后传递给该链，然后传递给该链，具体例子，具体例子，让我们看看我们在不同类型链之间路由，让我们看看我们在不同类型链之间路由。



![](img/33ec68ac66317c48322d0ad86cdb256f_140.png)

根据进来的主题，根据进来的主题，我们有不同的提示，我们有不同的提示，一个好问题解答物理，第二个解答数学，第三个历史，第四个计算机科学，定义所有提示模板。



![](img/33ec68ac66317c48322d0ad86cdb256f_142.png)

有了这些提示模板。

![](img/33ec68ac66317c48322d0ad86cdb256f_144.png)

然后提供更多信息，可以给每个命名。

![](img/33ec68ac66317c48322d0ad86cdb256f_146.png)

然后描述，物理的描述，一个适合回答物理问题。

![](img/33ec68ac66317c48322d0ad86cdb256f_148.png)

此信息将传递给路由器链。

![](img/33ec68ac66317c48322d0ad86cdb256f_150.png)

因此路由器链可决定何时使用此子链。

![](img/33ec68ac66317c48322d0ad86cdb256f_152.png)

现在导入我们需要的其他类型链。

![](img/33ec68ac66317c48322d0ad86cdb256f_154.png)

我们需要一个多提示链，这是一种特定类型的链，用于在多个不同的提示模板之间路由。

![](img/33ec68ac66317c48322d0ad86cdb256f_156.png)

如你所见，我们所有的选项都是提示模板本身。

![](img/33ec68ac66317c48322d0ad86cdb256f_158.png)

但这只是你可以路由之间的类型之一，你可以在任意类型的链之间路由。

![](img/33ec68ac66317c48322d0ad86cdb256f_160.png)

我们还将实现的其他类是llm路由器链，使用语言模型路由子链。

![](img/33ec68ac66317c48322d0ad86cdb256f_162.png)

将使用上述描述和名称。

![](img/33ec68ac66317c48322d0ad86cdb256f_164.png)

导入路由器输出解析器，解析输出为字典，用于下游确定使用哪个链。

![](img/33ec68ac66317c48322d0ad86cdb256f_166.png)

以及该链的输入，现在可以开始使用它，导入并定义将使用的语言模型。

![](img/33ec68ac66317c48322d0ad86cdb256f_168.png)

创建目标链，由路由器链调用的链。

![](img/33ec68ac66317c48322d0ad86cdb256f_170.png)

如你所见，每个目标链本身是语言模型链。

![](img/33ec68ac66317c48322d0ad86cdb256f_172.png)

一个llm链，除了目标链外。

![](img/33ec68ac66317c48322d0ad86cdb256f_174.png)

我们还需要一个默认训练，这是一个被称为，当路由器无法决定使用哪个子链时。

![](img/33ec68ac66317c48322d0ad86cdb256f_176.png)

上面的例子可能在输入问题与物理无关时被调用，数学历史，或计算机科学。

![](img/33ec68ac66317c48322d0ad86cdb256f_178.png)

现在定义llm用于在不同链间路由的模板，这是任务说明，输出格式需符合特定要求。

![](img/33ec68ac66317c48322d0ad86cdb256f_180.png)

让我们把这些部件组合起来构建路由器链。

![](img/33ec68ac66317c48322d0ad86cdb256f_182.png)

首先，我们以上述目的地格式化完整路由器模板。

![](img/33ec68ac66317c48322d0ad86cdb256f_184.png)

此模板适用于多种目的地，这里你可以做的是暂停，添加不同类型的目的地。

![](img/33ec68ac66317c48322d0ad86cdb256f_186.png)

所以在这里，与其只是物理学，数学史和计算机科学，可添加不同主题，如英语或拉丁语，接下来创建基于此模板的提示模板，然后通过传入llm创建路由器链。



![](img/33ec68ac66317c48322d0ad86cdb256f_188.png)

注意，总路由器提示包含路由器输出解析器，这很重要，因为它将帮助此链决定路由到哪些子链，最后，整合所有内容，可以创建总链，它有一个在此定义的路由器链，它包含在此传递的目的地链，然后还传递默认链。

现在可以使用此链。

![](img/33ec68ac66317c48322d0ad86cdb256f_190.png)

所以让我们问你一些问题，如果我们问它一个关于物理的问题。

![](img/33ec68ac66317c48322d0ad86cdb256f_192.png)

希望看到它路由到物理链并带有输入。

![](img/33ec68ac66317c48322d0ad86cdb256f_194.png)

什么是黑体辐射，然后传递到下面的链。

![](img/33ec68ac66317c48322d0ad86cdb256f_196.png)

我们可以看到响应非常详细，包含许多物理细节，在这里暂停视频并尝试输入不同内容，可以尝试使用上面定义的所有其他特殊链，例如，如果我们问它一个数学问题。



![](img/33ec68ac66317c48322d0ad86cdb256f_198.png)

应该看到它路由到数学链，然后传递到那里。

![](img/33ec68ac66317c48322d0ad86cdb256f_200.png)

我们还可以看到当我们传递一个问题时。

![](img/33ec68ac66317c48322d0ad86cdb256f_202.png)

它与任何子链无关，所以这里我们问它一个关于生物的问题。

![](img/33ec68ac66317c48322d0ad86cdb256f_204.png)

我们可以看到它选择的链是空，这意味着它将传递到默认链。

![](img/33ec68ac66317c48322d0ad86cdb256f_206.png)

它本身只是一个对语言模型的通用调用，幸运的是，语言模型对生物学了解很多。

![](img/33ec68ac66317c48322d0ad86cdb256f_208.png)

所以现在我们覆盖了这些基本构建块，链的类型，可以开始将它们组合起来创建非常有趣的应用程序，例如，在下一节。



![](img/33ec68ac66317c48322d0ad86cdb256f_210.png)