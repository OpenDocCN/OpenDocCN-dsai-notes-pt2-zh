# LangChain_微调ChatGPT提示词_RAG模型应用_agent_生成式AI - P3：3-微调在训练过程中的位置 - 吴恩达大模型 - BV1gLeueWE5N

在这堂课中，你将了解精细调整如何真正融入训练过程，它发生在一个被称为预训练的步骤之后，你将对其有一些详细的了解，然后，你将学习到所有可以应用的不同任务，精细调整就绪，让我们继续，好吗。

让我们先看看精细调整在哪里。

![](img/76b2048aef9885655cbfa3bb7b8819d6_1.png)

让我们看看预训练，这是精细调整发生之前的第一个步骤，实际上，它在开始时有一个模型，那完全是随机的，它对世界一无所知，所以所有它的权重，如果你熟悉权重，那么它们是完全随机的，它完全无法形成英语单词。

它还没有语言技能，而且它学习的目标下一个标记预测或真的，你知道，从简化的角度来看，在这里它就是下一个词的预测，所以你看到一次这个词，所以我们现在希望它能预测这个词。

但是当你看到llm只是产生sd感叹号时，感叹号在所以，离这个词upon非常远，这就是它开始的地方，但它正在从巨大的数据集中读取和理解，常常从整个网络中抓取，我们常常称这个为未标记的。

因为它不是我们一起结构化的。

![](img/76b2048aef9885655cbfa3bb7b8819d6_3.png)

我们只是直接从网络上抓取它，我会说它已经经历了许多许多清洁过程，所以，为了获取这个数据集，仍然需要大量的手动工作，对于模型预训练来说，要有效，因为模型本质上是在通过下一个标记词的预测来监督自己。

它只需要预测下一个词，实际上没有标签，否则，在这里训练后，你看，模型现在能够预测单词或标记或，嗯，而且它是一种学习的语言，它从互联网上学习了大量的知识，所以，这个过程实际上能工作真是太棒了，用这种方式。

而且因为它只是试图预测下一个标记，所以令人惊叹，现在，它正在阅读整个互联网的数据量来做到这一点。

![](img/76b2048aef9885655cbfa3bb7b8819d6_5.png)

好的，也许'整个互联网'上有一个星号，数据和从整个互联网上抓取的数据，这个背后的实际理解和知识往往并不公开，人们，实际上并不清楚那个数据集的具体样子，对于大型公司的许多封闭源模型。



![](img/76b2048aef9885655cbfa3bb7b8819d6_7.png)

但是luther ai进行了一次惊人的开源努力，创建了一个数据集叫做堆，你在这个实验室中将有机会探索它，它的意思是它是一个由两个组成的集合，两个来自整个互联网的多样化数据集。



![](img/76b2048aef9885655cbfa3bb7b8819d6_9.png)

你可以在这里看到这个图表，你知道有四百八十七年，还有林肯的胡萝卜蛋糕食谱，当然也是从pubmed中抓取，有关不同医学文本的信息，最后这里还有来自github的代码，所以它是一个包含相当智能的数据集。

被精心挑选在一起，以实际将这些模型注入知识，现在，这个预训练步骤实际上是非常昂贵和时间消耗的，因为它需要花费大量的时间来让模型遍历所有这些数据，从绝对的随机性到理解一些这些文本，你知道。

制作胡萝卜蛋糕食谱，同时编写代码。

![](img/76b2048aef9885655cbfa3bb7b8819d6_11.png)

好的，这些基于预训练的模型很棒，实际上，外面有很多开源的它们，你知道，它们被训练在这些来自网络的数据集上，你可能在这里看到左上角的地理作业，它问，印度的首都是什么，肯尼亚的首都是什么，在所有这些中。

法国的首都是什么，你知道，在没有看到答案的情况下，当你输入墨西哥的首都是什么时，lm可能会说匈牙利的首都是什么，你可以看到，它不是从聊天机器人界面的角度来看非常有用的。



![](img/76b2048aef9885655cbfa3bb7b8819d6_13.png)

那么如何使它达到聊天机器人界面，微调是实现这一目标的一种方式，它应该是你工具箱中的一种工具，预训练实际上是第一步，它给你那个基础模型，当你添加更多的数据时，实际上不是那么多数据。

你可以使用微调来获取一个微调模型，甚至一个微调模型，你可以在后续添加更多的微调步骤，微调实际上是一个后续步骤，你可以使用相同的类型的数据，实际上，你可能可以从不同的来源抓取数据并一起筛选。

稍后你会看到这一点，这样它就可以是这个引言，未标记的数据，但你也可以自己编辑数据，以便为模型学习提供更多的结构化信息，我认为一个关键的区别在于，微调与预训练，需要的数据要少得多。

你正在构建在这个基础模型上，这个模型已经学习了如此多的知识和基本语言技能，你实际上是将其提升到下一个级别，你不需要那么多数据，所以这确实在你的工具箱中，如果你来自其他机器学习领域。

你知道这是对判别性任务的微调，也许你在处理图像，你已经在imagenet上进行了微调，在这里，微调的定义稍微宽松一些，对于生成性任务，它定义得不如判别性任务明确，因为我们实际上是在更新整个模型的权重。

不仅仅是它的一部分，这通常是微调的情况，那些其他的模型类型，所以，我们在这里与预训练的目标相同，对于微调，下一个标记的生产，我们所做的只是改变数据，以便以某种方式更有结构。

并且模型可以更一致地输出和模仿这种结构，此外，还有更先进的方法可以减少您想要更新此模型的程度，稍后我们将讨论这个问题。



![](img/76b2048aef9885655cbfa3bb7b8819d6_15.png)

所以，微调对你们做了什么，所以你现在开始理解它是什么样子了，但是任务有哪些不同，这样你就可以用它做得很好，我想象的一个巨大类别就是行为改变，你在改变模型的行为，你正在告诉它确切的，你知道在这个聊天界面。

我们现在在一个聊天设置中，我们不在看调查，所以这导致模型能够更一致地响应，这意味着模型可以更专注于，也许这对审核来说会更好，例如，而且这也是一般性地在挖掘其能力，所以这里它在对话上更好。

所以它可以现在谈论各种各样的事情，与以前相比，我们需要做很多提示工程，以便挖掘出那个信息，微调也可以帮助模型获得新知识。



![](img/76b2048aef9885655cbfa3bb7b8819d6_17.png)

所以这可能是关于不在那个基础中的特定主题。

![](img/76b2048aef9885655cbfa3bb7b8819d6_19.png)

预训练模型，这可能意味着纠正旧的错误信息，所以也许有，你更希望模型实际吸收的更新一些最近的信息，当然，最常见的是你正在做这两件事，所以经常你会改变行为，你想要它获得新知识，所以往下降一个档次。



![](img/76b2048aef9885655cbfa3bb7b8819d6_21.png)

所以微调任务，对于llms来说，实际上就是文本和文本输出，我喜欢把它分为两个不同的分类，所以你可以这么想，一个作为提取文本，所以你输入文本，然后你得到较少的文本输出，所以很多工作都在阅读上。

这可能是提取关键词，你可能要路由的主题，你知道，基于你看到的所有数据，你路由聊天，例如，路由到API或其他不同代理在这里，像不同代理的能力，这与扩展相反，这就是你输入文本的地方。

然后你得到更多的文本输出，我喜欢把它想成写作，所以这可能是聊天，写电子邮件，写代码，真正理解你的任务，这两个不同任务之间的确切区别，或者你可能有多个任务想要微调，我发现这是最明确的成功指标。

如果你想成功，微调模型是明确你想要做什么任务的关键，清晰意味着知道什么是，你知道一个好的，你知道什么样的好输出看起来。



![](img/76b2048aef9885655cbfa3bb7b8819d6_23.png)

那个输出看起来什么样子，但也知道什么样的输出更好，当你知道某件事在写代码方面做得更好，或者在实际帮助路由任务方面做得更好。



![](img/76b2048aef9885655cbfa3bb7b8819d6_25.png)

你实际上微调这个模型来做得很好，好的，如果你这是首次微调，我推荐几个不同步骤，首先，通过提示工程识别一个任务，只要大型llm，例如，聊天bot，可以是，所以，你就只是在与chgbt玩耍。

像你通常做的那样，然后你找到了一些，你知道，它正在执行的任务，好的，是的，所以不是非常好，但也不像非常糟糕，所以你知道这在可能的范围内是可能的，但它不是，它不是最好的，你想要它为你的任务做得更好。

所以选择那个任务，然后只选择一个，然后数字四，嗯，为那个任务获取一些输入和输出，所以你输入一些文本，然后你得到了一些文本输出，嗯，获取输入，你在哪里输入文本，得到文本输出，输出，对于这个任务。

这些对的数量，其中我喜欢使用的一个黄金数字是一千，因为我发现那是开始需要数据的一个好地方。

![](img/76b2048aef9885655cbfa3bb7b8819d6_27.png)

并确保这些输入和输出比'好'更好。

![](img/76b2048aef9885655cbfa3bb7b8819d6_29.png)

在您无法生成这些输入之前，LLM的结果，输出的必要并非总是，所以确保你有这些数据对，你也将在实验室中探索这一点，整个管道在这里，从那里开始，然后，你可以在这个数据上微调一个小的LLM。

只是为了感受到性能的提升，如果这是你第一次，这是我推荐的，现在让我们进入实验室，在那里，你可以探索用于预训练和微调的数据集，所以你完全理解这些输入输出对的样子。



![](img/76b2048aef9885655cbfa3bb7b8819d6_31.png)

好的，我们将开始通过导入一些不同的库来开始，我们将运行那个，我们首先将使用的库是datasets，来自Hugging Face的库，他们有一个伟大的函数叫做load data set。

你可以直接从他们的hub拉取数据集并运行它。

![](img/76b2048aef9885655cbfa3bb7b8819d6_33.png)

我在这里将拉取预训练数据集，叫做你看到的那个堆栈，我在这里抓取分割，训练集与测试集，并且非常具体地，我实际上正在抓取流式，等于true，因为这个数据集非常大，我们不能在没有破坏这个笔记本的情况下下载它。

所以实际上，我将逐个流式传输它，以便我们可以探索那里的不同数据部分，所以只是加载它。

![](img/76b2048aef9885655cbfa3bb7b8819d6_35.png)

现在我要只看前五个，所以这正在使用itertools。

![](img/76b2048aef9885655cbfa3bb7b8819d6_37.png)

很好，好的，在这里，你可以在预训练数据集中看到，这里有很多看起来像是从网络上抓取的数据，你知道，这个文本说它已经完成并提交，你可以在安卓上玩生存模式tcs，这就是一个例子，让我们看看是否能找到另一个。

在这里，这里有另一个，这就是从网络上抓取的代码，被抓取的XML代码，这是另一个数据点，在这里，你会看到文章内容，你会看到这个主题的内容，你知道，亚马逊在aws上宣布了一个新服务，然后这里是关于，你知道。

大满贯钓鱼游艇，这是一家家庭企业，这就是，你知道，就是一种从互联网上抓取的不同数据集的混乱，我想对比，与将在不同实验室中使用的一组进行微调的数据集，我们正在抓取一家公司的，问题答案对数据集，你知道。

是从FAQ抓取的，也是关于内部工程文档的汇编，它被称为lamini docs，是关于公司的，Lamini，嗯，所以我们只是读取那个json文件，并看看里面有什么，好的，所以这是非常结构化的数据，对吗。

这里有问题答案对，它对这个公司非常具体。

![](img/76b2048aef9885655cbfa3bb7b8819d6_39.png)

使用这个数据集的最简单的方法是将问题与答案拼接起来。

![](img/76b2048aef9885655cbfa3bb7b8819d6_41.png)

实际上，这些问题和答案，并服务给模型，这就是我在这里要做的，我将将其转换为字典，然后我会看看将其中一个拼接起来实际上看起来像什么。



![](img/76b2048aef9885655cbfa3bb7b8819d6_43.png)

所以你知道，只是将问题直接拼接起来，然后。

![](img/76b2048aef9885655cbfa3bb7b8819d6_45.png)

在这里直接给出答案，当然，你可以以任何可能的方式准备你的数据。

![](img/76b2048aef9885655cbfa3bb7b8819d6_47.png)

我只是想指出几种不同的常见方式，来格式化和结构化你的数据，所以问题答案对，但是，也包括指令和响应对，输入输出对，在这里非常通用，而且，实际上，你可以只是，因为我们正在拼接它。

它就是你看到的上面的文本堆叠，好的，所以拼接它，你知道这非常简单，但有时这就是足够的看到结果，有时它不是嗯你，所以你会发现模型可能需要更多的结构来帮助它。



![](img/76b2048aef9885655cbfa3bb7b8819d6_49.png)

这实际上与提示工程非常相似，所以进一步来说，你也可以使用指令跟随的数据处理，在这种情况下，问题回答提示模板，这里有一个常见的模板注意。



![](img/76b2048aef9885655cbfa3bb7b8819d6_51.png)

在问题前面有一个＃＃＃，一种标记，所以这可以很容易地被用作结构来告诉模型期待什么接下来。

![](img/76b2048aef9885655cbfa3bb7b8819d6_53.png)

它期待看到问题后的问题，这也可以帮助你后处理模型的输出。

![](img/76b2048aef9885655cbfa3bb7b8819d6_55.png)

即使在它被微调后，我们有那个，所以让我们来看看这个提示模板在实际中的作用。

![](img/76b2048aef9885655cbfa3bb7b8819d6_57.png)

并看看它与拼接的问题答案如何不同。

![](img/76b2048aef9885655cbfa3bb7b8819d6_59.png)

你可以看到如何，这就是提示模板的样子，问题答案在那里做得很整洁。

![](img/76b2048aef9885655cbfa3bb7b8819d6_61.png)

常常帮助保持输入和输出分开，所以我实际上要删除这个答案在这里，并将它们分开出来，因为这个房子只是使用数据集很容易地进行评估，你知道，当你将数据集分成训练和测试时，所以现在我要做的就是将所有这些。



![](img/76b2048aef9885655cbfa3bb7b8819d6_63.png)

你知道，将所有模板应用到整个数据集上。

![](img/76b2048aef9885655cbfa3bb7b8819d6_65.png)

所以只是运行一个for循环，并仅填充提示，那就是，你知道，将问题答案添加到这个中，使用f字符串或格式化东西。



![](img/76b2048aef9885655cbfa3bb7b8819d6_67.png)

在这里使用Python，好吧，所以让我们看看文本之间的差异。

![](img/76b2048aef9885655cbfa3bb7b8819d6_69.png)

唯一的事情，嗯，和问题答案格式。

![](img/76b2048aef9885655cbfa3bb7b8819d6_71.png)

酷，所以只包含文本，所有的内容都在这里拼接，你是输入的，在这里只有问题答案，更加结构化，你可以使用任何一种，当然，我推荐结构化它以帮助评估，基本上就是这样。

存储这种数据的最常见的方式通常是在json行文件中。

![](img/76b2048aef9885655cbfa3bb7b8819d6_73.png)

所以json l文件，Json l，它基本上就是，你知道，每一行都是一个json对象。

![](img/76b2048aef9885655cbfa3bb7b8819d6_75.png)

这就是全部，所以只是将那个写入文件，你也可以将这个数据集上传到hugging face。

![](img/76b2048aef9885655cbfa3bb7b8819d6_77.png)

嗯，在这里显示，因为你也会 later 使用它。

![](img/76b2048aef9885655cbfa3bb7b8819d6_79.png)

你可以从那样从云中拉取它，接下来，你将深入到一个特定的微调变体，叫做指令。

![](img/76b2048aef9885655cbfa3bb7b8819d6_81.png)